<!DOCTYPE html>
<html lang="zh-CN" data-theme-mode="dark">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="MY HOME ä¸ªäººä¸»é¡µ">
    <meta name="keywords" content="Homepage,JavaTool,ä¸ªäººä¸»é¡µ">
    <meta name="author" content="MY HOME">
    <title>MY HOME - ä¸ªäººä¸»é¡µ</title>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link rel="preload" href="//at.alicdn.com/t/c/font_4552607_0khxww3tj3q9.woff2" as="font" type="font/woff2" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/dmego-home-page@latest/assets/css/iconfont.css">
    
    <svg style="display: none">
      <filter id="glass-distortion">
        <feTurbulence type="fractalNoise" baseFrequency="0.001 0.005" numOctaves="1" seed="17" result="turbulence" />
        <feComponentTransfer in="turbulence" result="mapped">
          <feFuncR type="gamma" amplitude="1" exponent="10" offset="0.5" />
          <feFuncG type="gamma" amplitude="0" exponent="1" offset="0" />
          <feFuncB type="gamma" amplitude="0" exponent="1" offset="0.5" />
        </feComponentTransfer>
        <feGaussianBlur in="turbulence" stdDeviation="3" result="softMap" />
        <feSpecularLighting in="softMap" surfaceScale="5" specularConstant="1" specularExponent="100" lighting-color="white" result="specLight">
          <fePointLight x="-200" y="-200" z="300" />
        </feSpecularLighting>
        <feComposite in="specLight" operator="arithmetic" k1="0" k2="1" k3="1" k4="0" result="litImage" />
        <feDisplacementMap in="SourceGraphic" in2="softMap" scale="200" xChannelSelector="R" yChannelSelector="G" />
      </filter>
    </svg>

    <style type="text/css">
#loader {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: #ffffff;
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    transition: opacity 0.6s ease, visibility 0.6s ease;
}
.loading-left-bg, .loading-right-bg {
    position: absolute;
    top: 0;
    width: 50%;
    height: 100%;
    background: #f5faf7;
    transition: transform 0.6s ease;
}
.loading-left-bg { left: 0; }
.loading-right-bg { right: 0; }
#loader.loaded .loading-left-bg { transform: translateX(-100%); }
#loader.loaded .loading-right-bg { transform: translateX(100%); }
#loader.loaded { opacity: 0; visibility: hidden; }
.spinner-box { text-align: center; }
.loading-taichi svg {
    width: 80px;
    height: 80px;
    fill: #2d8b69;
    transition: fill 0.3s ease;
}
.loading-word {
    margin-top: 20px;
    color: #3a9e7c;
    font-size: 16px;
    letter-spacing: 3px;
    transition: color 0.3s ease;
}
.iconfont {
    font-family: "iconfont" !important;
    font-size: inherit;
    font-style: normal;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}
.glass-effect {
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(12px) saturate(180%) contrast(1.1) brightness(1.05);
    -webkit-backdrop-filter: blur(12px) saturate(180%) contrast(1.1) brightness(1.05);
    border: 1px solid rgba(255, 255, 255, 0.15);
    box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.08),
        inset 1px 1px 0 rgba(255, 255, 255, 0.2),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05);
    position: relative;
    overflow: hidden;
}
.glass-effect-light {
    background: rgba(255, 255, 255, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.3);
}
.glass-effect-dark {
    background: rgba(30, 30, 40, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.08);
}
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}
html, body {
    overflow-x: hidden !important;
    position: relative;
    width: 100%;
}
html {
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-thumb) var(--scrollbar-track);
}
html[data-theme-mode="dark"] {
    --bg-base: rgba(15, 18, 26, 0.7);
    --bg-mask: linear-gradient(rgba(15, 18, 26, 0.7), rgba(15, 18, 26, 0.65));
    --bg-card: rgba(28,32,42,0.9);
    --bg-card-light: rgba(28,32,42,0.75);
    --bg-nav: rgba(28, 32, 42, 0.6);
    --bg-footer: rgba(28,32,42,0.6);
    --color-text-main: #e2e8e5;
    --color-text-sub: #b8c4bc;
    --color-text-title: #f2f8f5;
    --color-green: #38a169;
    --color-green-deep: #2d8b69;
    --border-color: rgba(255, 255, 255, 0.1);
    --border-color-light: rgba(255,255,255,0.07);
    --shadow-color: rgba(0,0,0,0.25);
    --scrollbar-thumb: rgba(45, 139, 105, 0.6);
    --scrollbar-track: rgba(22,25,29,0.8);
    --glass-bg: rgba(40, 44, 52, 0.08);
    --glass-border: rgba(255, 255, 255, 0.1);
    --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
    --glass-inset-light: rgba(255, 255, 255, 0.1);
    --glass-inset-dark: rgba(0, 0, 0, 0.05);
    --hover-glow: rgba(45, 139, 105, 0.3);
    --active-scale: 0.97;
    --font-family-main: "æ€æºåœ†è§’ CN", "PingFang SC Round", "Microsoft YaHei UI Light", "åœ†æ¶¦é»‘ä½“ CN", "è‹¹æ–¹-åœ†è§’", sans-serif;
    --font-weight-light: 300;
    --font-weight-normal: 400;
    --font-weight-medium: 500;
    --font-weight-bold: 600;
}
html[data-theme-mode="light"] {
    --bg-base: #fafcf9;
    --bg-mask: linear-gradient(rgba(250, 252, 249, 0.95), rgba(245, 250, 247, 0.9));
    --bg-card: rgba(255, 255, 255, 0.92);
    --bg-card-light: rgba(255, 255, 255, 0.85);
    --bg-nav: rgba(255, 255, 255, 0.85);
    --bg-footer: rgba(255, 255, 255, 0.85);
    --color-text-main: #3a4a42;
    --color-text-sub: #6b7c73;
    --color-text-title: #1c2c22;
    --color-green: #2db48d;
    --color-green-deep: #1f9c7a;
    --border-color: rgba(0, 0, 0, 0.08);
    --border-color-light: rgba(0, 0, 0, 0.05);
    --shadow-color: rgba(45, 180, 141, 0.12);
    --scrollbar-thumb: rgba(45, 180, 141, 0.5);
    --scrollbar-track: rgba(245, 250, 247, 0.9);
    --glass-bg: rgba(255, 255, 255, 0.65);
    --glass-border: rgba(255, 255, 255, 0.9);
    --glass-shadow: 
        0 10px 40px rgba(45, 180, 141, 0.1),
        0 4px 12px rgba(0, 0, 0, 0.04);
    --glass-inset-light: rgba(255, 255, 255, 0.9);
    --glass-inset-dark: rgba(255, 255, 255, 0.3);
    --hover-glow: rgba(45, 180, 141, 0.18);
    --active-scale: 0.98;
    --font-family-main: "æ€æºåœ†è§’ CN", "PingFang SC Round", "Microsoft YaHei UI Light", "åœ†æ¶¦é»‘ä½“ CN", "è‹¹æ–¹-åœ†è§’", sans-serif;
    --font-weight-light: 350;
    --font-weight-normal: 400;
    --font-weight-medium: 500;
    --font-weight-bold: 600;
}
body {
    font-family: var(--font-family-main);
    min-height: 100vh;
    color: var(--color-text-main);
    scroll-behavior: smooth;
    background-size: cover;
    display: flex;
    flex-direction: column;
    position: relative;
    z-index: 1;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    -webkit-text-stroke: 0.2px transparent;
    text-rendering: optimizeLegibility;
    font-size: 15px;
    line-height: 1.75;
    width: 100%;
    transition: font-size 0.3s ease, color 0.3s ease, font-weight 0.3s ease;
    letter-spacing: 0.3px;
}
html[data-theme-mode="light"] body::before {
    background: linear-gradient(rgba(250, 252, 249, 0.95), rgba(245, 250, 247, 0.9));
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
}
body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--bg-mask);
    z-index: -2;
    display: var(--mask-display, block);
}
a {
    text-decoration: none;
    color: inherit;
}
ul {
    list-style: none;
}
img {
    max-width: 100%;
    border-radius: 8px;
    object-fit: cover;
    object-position: center;
    opacity: 1;
    transition: opacity 0.6s cubic-bezier(0.16, 1, 0.3, 1), transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    transform: translateZ(0);
    will-change: opacity, transform;
}
img.lazy-img {
    opacity: 0;
}
img.loaded {
    opacity: 1;
}
img:hover {
    transform: scale(1.02);
}
.sidebar-author img {
    opacity: 1 !important;
    display: block !important;
    margin: 0 auto 10px auto;
}
video {
    max-width: 100%;
    border-radius: 8px;
    object-fit: cover;
    object-position: center;
    opacity: 0;
    transition: opacity 0.6s cubic-bezier(0.16, 1, 0.3, 1), transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    cursor: pointer;
    transform: translateZ(0);
    will-change: transform;
}
video.loaded {
    opacity: 1;
}
.rotate {
    transition: transform 4s linear infinite;
}
.rotate:hover {
    transform: rotate(360deg);
}
.container {
    flex: 1;
    position: relative;
    z-index: 3;
    width: 100%;
    max-width: 100vw;
    padding-bottom: 80px;
}
.container-main {
    display: flex;
    gap: 20px;
    max-width: 1200px;
    margin: 20px auto;
    padding: 0 20px;
    position: relative;
    z-index: 5;
    width: 100%;
    min-height: calc(100vh - 200px);
    align-items: flex-start;
}
#header-nav {
    width: calc(100% - 40px);
    margin: 0px auto 0 auto;
    border-radius: 20px;
    padding: 5px 20px;
    position: sticky;
    top: 15px;
    z-index: 99;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
    background: var(--glass-bg);
    backdrop-filter: blur(12px) saturate(180%) contrast(1.1) brightness(1.05);
    -webkit-backdrop-filter: blur(12px) saturate(180%) contrast(1.1) brightness(1.05);
    border: 1px solid var(--glass-border);
    box-shadow: 
        var(--glass-shadow),
        inset 1px 1px 0 var(--glass-inset-light),
        inset -1px -1px 0 var(--glass-inset-dark);
    position: relative;
}
html[data-theme-mode="light"] #header-nav {
    backdrop-filter: blur(16px) saturate(200%) contrast(1.1) brightness(1.08);
    -webkit-backdrop-filter: blur(16px) saturate(200%) contrast(1.1) brightness(1.08);
    box-shadow: 
        0 12px 40px rgba(45, 180, 141, 0.08),
        0 4px 8px rgba(0, 0, 0, 0.02),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(255, 255, 255, 0.4);
}
.nav-center {
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    gap: 25px;
    margin: 0;
    padding: 0;
    z-index: 0;
    max-width: calc(100% - 200px);
    box-sizing: border-box;
}
.main-nav-link-wrap {
    margin: 0;
    display: inline-block;
}
.main-nav-link {
    padding: 10px 28px;
    font-size: 15px;
    font-weight: var(--font-weight-medium);
    color: var(--color-text-sub);
    border-radius: 26px;
    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
    overflow: hidden;
    background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(0,0,0,0.02));
    backdrop-filter: blur(10px) saturate(200%);
    -webkit-backdrop-filter: blur(10px) saturate(200%);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 
        inset 1px 1px 0 rgba(255,255,255,0.15),
        inset -1px -1px 0 rgba(0,0,0,0.06),
        0 2px 4px rgba(0,0,0,0.03);
    transform: translateZ(0);
}
.main-nav-link.active {
    color: #fff !important;
    background: linear-gradient(145deg, rgba(56,161,105,0.2), rgba(45,139,105,0.15)) !important;
    border-color: rgba(56, 161, 105, 0.5) !important;
    font-weight: var(--font-weight-bold);
    box-shadow: 
        0 8px 25px var(--hover-glow),
        inset 1px 1px 0 rgba(255,255,255,0.2),
        inset -1px -1px 0 rgba(0,0,0,0.08);
    transform: scale(1.03);
}
html[data-theme-mode="light"] .main-nav-link {
    color: var(--color-text-main);
    background: rgba(255, 255, 255, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.8);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.03),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05);
}
html[data-theme-mode="light"] .main-nav-link.active {
    color: #fff !important;
    background: linear-gradient(135deg, var(--color-green), var(--color-green-deep)) !important;
    border-color: var(--color-green) !important;
    box-shadow: 
        0 8px 25px var(--hover-glow),
        0 4px 8px rgba(45, 180, 141, 0.2),
        inset 1px 1px 0 rgba(255, 255, 255, 0.3),
        inset -1px -1px 0 rgba(0, 0, 0, 0.1);
}
.main-nav-link:hover:not(.active) {
    color: var(--color-green) !important;
    background: rgba(56, 161, 105, 0.08) !important;
    border-color: rgba(56,161,105,0.4) !important;
    transform: translateY(-3px) scale(1.02);
    box-shadow: 
        0 8px 20px var(--hover-glow),
        inset 1px 1px 0 var(--glass-inset-light),
        inset -1px -1px 0 var(--glass-inset-dark);
}
html[data-theme-mode="light"] .main-nav-link:hover:not(.active) {
    background: rgba(45, 180, 141, 0.12) !important;
    border-color: var(--color-green) !important;
    color: var(--color-green-deep) !important;
    box-shadow: 
        0 8px 20px var(--hover-glow),
        0 4px 8px rgba(45, 180, 141, 0.1),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05);
}
.main-nav-link:active {
    transform: translateY(0) scale(var(--active-scale));
    box-shadow:0 2px 8px rgba(56,161,105,0.1) !important;
}
.main-nav-link::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(56, 161, 105, 0.12);
    transform: translate(-50%, -50%);
    transition: width 0.7s ease, height 0.7s ease;
}
.main-nav-link:active::after {
    width: 320px;
    height: 320px;
}
.nav-right {
    display: flex;
    align-items:center;
    justify-content:flex-end;
    flex-shrink:0;
    margin:0;padding:0;
    flex: 0 0 auto;
    margin-left: auto;
    width: auto;
    padding-left: 20px;
}
.github-login-btn, .user-name-display {
    padding:8px 16px;font-size:14px;color:var(--color-text-sub);background:transparent;border:1px solid rgba(255,255,255,0.08);border-radius:20px;cursor:pointer;transition:all 0.4s cubic-bezier(0.34,1.56,0.64,1);display:flex;align-items:center;gap:6px;backdrop-filter:blur(8px) saturate(180%);-webkit-backdrop-filter:blur(8px) saturate(180%);box-shadow:inset 1px 1px 0 rgba(255,255,255,0.1),inset -1px -1px 0 rgba(0,0,0,0.05);
}
.github-login-btn:hover, .user-name-display:hover {
    background:rgba(56,161,105,0.08);color:var(--color-green);transform:translateY(-3px) scale(1.02);border-color:rgba(56,161,105,0.2);box-shadow:0 6px 20px var(--hover-glow);
}
.github-login-btn:active, .user-name-display:active {transform:translateY(0) scale(var(--active-scale));}
.user-name-display {color:var(--color-green);}
.theme-bg-switch-group {
    display:flex;
    align-items:center;
    gap:12px;
    z-index:1;
    flex-shrink: 0;
}
.theme-switch-wrap {width:55px;display:flex;align-items:center;justify-content:flex-start;flex-shrink:0;margin:0;padding:0;position:static;transform:none;}
.bg-switch-wrap {width:90px;height:26px;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin:0;padding:0;}
.bg-switch-btn {width:90px;height:26px;border-radius:34px;background-color:transparent;border:1px solid var(--border-color);cursor:pointer;display:flex;align-items:center;justify-content:center;gap:4px;color:var(--color-text-sub);font-size:13px;transition:all 0.4s cubic-bezier(0.34,1.56,0.64,1);backdrop-filter:blur(3px) saturate(150%);-webkit-backdrop-filter:blur(3px) saturate(150%);box-shadow:inset 1px 1px 0 var(--glass-inset-light),inset -1px -1px 0 var(--glass-inset-dark);}
html[data-theme-mode="light"] .bg-switch-btn {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.9);
    color: var(--color-text-main);
    box-shadow: 
        0 2px 6px rgba(0, 0, 0, 0.04),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05);
}
.bg-switch-btn:hover {background-color:rgba(56,161,105,0.08);border-color:rgba(56,161,105,0.3);box-shadow:0 0 12px var(--hover-glow);color:var(--color-green);transform:translateY(-3px) scale(1.03);}
html[data-theme-mode="light"] .bg-switch-btn:hover {
    background: rgba(45, 180, 141, 0.12);
    border-color: var(--color-green);
    color: var(--color-green-deep);
    box-shadow: 
        0 4px 12px var(--hover-glow),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95);
}
.bg-switch-btn:active {transform:translateY(0) scale(var(--active-scale));}
.theme-switch {position:relative;display:inline-block;width:52px;height:26px;cursor:pointer;}
.theme-switch input {opacity:0;width:0;height:0;}
.theme-slider {position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:transparent;border-radius:34px;border:1px solid var(--border-color);transition:all 0.3s cubic-bezier(0.34,1.56,0.64,1);backdrop-filter:blur(3px) saturate(150%);-webkit-backdrop-filter:blur(3px) saturate(150%);box-shadow:inset 1px 1px 0 rgba(255,255,255,0.1),inset -1px -1px 0 rgba(0,0,0,0.05);}
.theme-slider:before {position:absolute;content:"";height:20px;width:20px;left:2px;bottom:2px;background-color:rgba(255,255,255,0.9);border-radius:50%;transition:all 0.3s cubic-bezier(0.34,1.56,0.64,1);display:flex;align-items:center;justify-content:center;color:#333;font-size:10px;content:"ðŸŒ™";box-shadow:0 2px 6px rgba(0,0,0,0.15);}
input:checked + .theme-slider {background-color:rgba(56,161,105,0.08);border-color:rgba(56,161,105,0.2);box-shadow:0 0 10px var(--hover-glow);}
input:checked + .theme-slider:before {transform:translateX(26px);content:"â˜€ï¸";background-color:var(--color-green);color:#fff;box-shadow:0 2px 8px rgba(56,161,105,0.3);}
.theme-slider:hover {box-shadow:0 0 10px var(--hover-glow);}
html[data-theme-mode="light"] .theme-slider {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.9);
    box-shadow: 
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05);
}
html[data-theme-mode="light"] input:checked + .theme-slider {
    background: rgba(45, 180, 141, 0.15);
    border-color: var(--color-green);
    box-shadow: 0 0 12px rgba(45, 180, 141, 0.2);
}
html[data-theme-mode="light"] input:checked + .theme-slider:before {
    background: var(--color-green);
    color: #fff;
    box-shadow: 0 2px 8px rgba(45, 180, 141, 0.3);
}
html[data-theme-mode="dark"] .sidebar-author-name {font-size:18px;font-weight:var(--font-weight-bold);letter-spacing:1px;}
html[data-theme-mode="dark"] .sidebar-description {font-size:14px;font-weight:var(--font-weight-light);color:var(--color-text-sub);}
html[data-theme-mode="dark"] .sidebar-menu-link {font-size:15px;font-weight:var(--font-weight-normal);}
html[data-theme-mode="dark"] .sidebar-menu-link:hover {font-weight:var(--font-weight-bold);}
html[data-theme-mode="dark"] .main-nav-link {color:var(--color-text-sub);border-color:rgba(255,255,255,0.1);box-shadow:inset 1px 1px 0 rgba(255,255,255,0.2),inset -1px -1px 0 rgba(0,0,0,0.06);}
html[data-theme-mode="dark"] .article-title {font-size:28px;font-weight:var(--font-weight-bold);color:var(--color-text-title);letter-spacing:1px;}
html[data-theme-mode="dark"] .article-signature {font-size:16px;font-weight:var(--font-weight-light);line-height:1.8;}
html[data-theme-mode="dark"] .article-signature strong {font-weight:var(--font-weight-bold);color:var(--color-green);}
html[data-theme-mode="dark"] .search-input {font-size:15px;font-weight:var(--font-weight-normal);}
html[data-theme-mode="dark"] .search-btn {font-size:15px;font-weight:var(--font-weight-bold);}
html[data-theme-mode="dark"] .news-title {font-size:24px;font-weight:var(--font-weight-bold);letter-spacing:0.5px;color:var(--color-text-title) !important;}
html[data-theme-mode="dark"] .news-content {font-size:17px;font-weight:var(--font-weight-normal);line-height:1.9;color:var(--color-text-main) !important;}
html[data-theme-mode="dark"] .news-date {font-size:13px;font-weight:var(--font-weight-light);opacity:0.9;}
html[data-theme-mode="dark"] .modal-news-title {font-size:25px;font-weight:var(--font-weight-bold);letter-spacing:1px;}
html[data-theme-mode="dark"] .modal-news-desc {font-size:17px;font-weight:var(--font-weight-normal);line-height:1.9;}
html[data-theme-mode="dark"] .modal-news-date {font-size:12px;font-weight:var(--font-weight-light);}
html[data-theme-mode="dark"] .update-log-title {font-size:15px;font-weight:var(--font-weight-bold);}
html[data-theme-mode="dark"] .update-log-version {font-size:14px;font-weight:var(--font-weight-bold);}
html[data-theme-mode="dark"] .update-log-content {font-size:13px;font-weight:var(--font-weight-light);line-height:1.7;}
html[data-theme-mode="dark"] #footer {font-size:13px;font-weight:var(--font-weight-light);}
html[data-theme-mode="dark"] #footer a {font-weight:var(--font-weight-bold);}
html[data-theme-mode="dark"] .music-text {font-size:12px;font-weight:var(--font-weight-light);}
html[data-theme-mode="dark"] .bg-switch-btn {font-size:13px;font-weight:var(--font-weight-normal);}
html[data-theme-mode="dark"] .news-item:hover .news-title {color:var(--color-green) !important;font-weight:700;}
html[data-theme-mode="light"] .sidebar-author-name {
    font-size: 19px;
    font-weight: var(--font-weight-bold);
    letter-spacing: 1px;
    color: var(--color-text-title);
}
html[data-theme-mode="light"] .sidebar-description {
    font-size: 14px;
    font-weight: var(--font-weight-light);
    color: var(--color-text-sub);
}
html[data-theme-mode="light"] .sidebar-menu-link {
    font-size: 15px;
    font-weight: var(--font-weight-normal);
    color: var(--color-text-main);
}
html[data-theme-mode="light"] .sidebar-menu-link:hover {
    font-weight: var(--font-weight-bold);
    color: var(--color-green-deep);
}
html[data-theme-mode="light"] .main-nav-link {
    color: var(--color-text-main);
    border-color: rgba(255, 255, 255, 0.9);
    box-shadow: inset 1px 1px 0 rgba(255,255,255,0.95), inset -1px -1px 0 rgba(0,0,0,0.06);
}
html[data-theme-mode="light"] .main-nav-link:hover:not(.active) {
    color: var(--color-green-deep) !important;
    background: rgba(45, 180, 141, 0.12) !important;
    border-color: var(--color-green) !important;
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 8px 20px var(--hover-glow);
}
html[data-theme-mode="light"] .main-nav-link.active {
    color: #fff !important;
    font-weight: var(--font-weight-bold);
    background: linear-gradient(135deg, var(--color-green), var(--color-green-deep)) !important;
    border-color: var(--color-green) !important;
}
html[data-theme-mode="light"] .article-title {
    font-size: 32px;
    font-weight: var(--font-weight-bold);
    color: var(--color-text-title);
    letter-spacing: 2px;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}
html[data-theme-mode="light"] .article-signature {
    font-size: 16px;
    font-weight: var(--font-weight-light);
    line-height: 1.8;
    color: var(--color-text-main);
}
html[data-theme-mode="light"] .article-signature strong {
    font-weight: var(--font-weight-bold);
    color: var(--color-green);
}
html[data-theme-mode="light"] .search-input {
    font-size: 15px;
    font-weight: var(--font-weight-normal);
}
html[data-theme-mode="light"] .search-btn {
    font-size: 15px;
    font-weight: var(--font-weight-bold);
}
html[data-theme-mode="light"] .news-title {
    font-size: 26px;
    font-weight: var(--font-weight-bold);
    letter-spacing: 0.5px;
    color: var(--color-text-title) !important;
}
html[data-theme-mode="light"] .news-content {
    font-size: 17px;
    font-weight: var(--font-weight-normal);
    line-height: 1.9;
    color: var(--color-text-main) !important;
}
html[data-theme-mode="light"] .news-date {
    font-size: 13px;
    font-weight: var(--font-weight-light);
    opacity: 0.9;
}
html[data-theme-mode="light"] .modal-news-title {
    font-size: 28px;
    font-weight: var(--font-weight-bold);
    letter-spacing: 1px;
    color: #000 !important;
}
html[data-theme-mode="light"] .modal-news-desc {
    font-size: 17px;
    font-weight: var(--font-weight-normal);
    line-height: 1.9;
    color: #000 !important;
}
html[data-theme-mode="light"] .modal-news-date {
    font-size: 12px;
    font-weight: var(--font-weight-light);
    color: #333 !important;
}
html[data-theme-mode="light"] .update-log-title {
    font-size: 15px;
    font-weight: var(--font-weight-bold);
}
html[data-theme-mode="light"] .update-log-version {
    font-size: 14px;
    font-weight: var(--font-weight-bold);
}
html[data-theme-mode="light"] .update-log-content {
    font-size: 13px;
    font-weight: var(--font-weight-light);
    line-height: 1.7;
}
html[data-theme-mode="light"] #footer {
    font-size: 13px;
    font-weight: var(--font-weight-light);
}
html[data-theme-mode="light"] #footer a {
    font-weight: var(--font-weight-bold);
}
html[data-theme-mode="light"] .music-text {
    font-size: 12px;
    font-weight: var(--font-weight-light);
}
html[data-theme-mode="light"] .bg-switch-btn {
    font-size: 13px;
    font-weight: var(--font-weight-normal);
}
html[data-theme-mode="light"] .news-item:hover .news-title {
    color: var(--color-green) !important;
    font-weight: 700;
}
#sidebar {
  width:270px;
  position:sticky !important;
  top: 88px;
  flex-shrink:0;
  margin-top:0;
  margin-left: -15px;
  margin-right: 8px;
  height: auto;
  align-self:flex-start;
  z-index:9;
}
.sidebar-wrap {
  background:var(--glass-bg);
  border-radius:20px;
  padding:25px;
  box-shadow:var(--glass-shadow),inset 1px 1px 0 var(--glass-inset-light),inset -1px -1px 0 var(--glass-inset-dark);
  border:1px solid var(--glass-border);
  transition:box-shadow 0.3s ease, transform 0.3s ease;
  backdrop-filter:blur(12px) saturate(180%) contrast(1.1);
  -webkit-backdrop-filter:blur(12px) saturate(180%) contrast(1.1);
  position:relative;
}
html[data-theme-mode="light"] .sidebar-wrap {
    background: rgba(255, 255, 255, 0.75);
    backdrop-filter: blur(20px) saturate(200%) contrast(1.1);
    -webkit-backdrop-filter: blur(20px) saturate(200%) contrast(1.1);
    border: 1px solid rgba(255, 255, 255, 0.9);
    box-shadow: 
        0 15px 50px rgba(45, 180, 141, 0.08),
        0 8px 20px rgba(0, 0, 0, 0.03),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05);
}
.sidebar-wrap:hover {box-shadow:0 10px 30px rgba(0,0,0,0.1),0 0 20px var(--hover-glow);}
.update-log-time-text {font-size:12px;color:var(--color-text-sub);padding-left:15px;margin-top:2px;}
.sidebar-author {text-align:center;}
.sidebar-author img {
    width:100px;height:100px;border-radius:50%;border:2px solid rgba(56,161,105,0.15);margin-bottom:10px;box-shadow:0 0 20px rgba(56,161,105,0.1);transition:all 0.6s cubic-bezier(0.34,1.56,0.64,1);
}
html[data-theme-mode="light"] .sidebar-author img {
    border: 2px solid rgba(45, 180, 141, 0.2);
    box-shadow: 
        0 8px 25px rgba(45, 180, 141, 0.15),
        0 4px 8px rgba(0, 0, 0, 0.05);
}
.sidebar-author img:hover {transform:scale(1.15) rotate(5deg);box-shadow:0 0 40px var(--hover-glow);border-color:rgba(56,161,105,0.4);}
html[data-theme-mode="light"] .sidebar-author img:hover {
    border-color: var(--color-green);
    box-shadow: 
        0 12px 40px rgba(45, 180, 141, 0.25),
        0 8px 20px rgba(0, 0, 0, 0.08);
}
.sidebar-author-name {font-size:18px;font-weight:var(--font-weight-bold);color:var(--color-text-title);margin-bottom:5px;}
.sidebar-description {color:var(--color-text-sub);font-size:14px;font-weight:var(--font-weight-light);}
.sidebar-social {display:flex;justify-content:center;gap:20px;font-size:22px;margin:0px 0;}
.sidebar-social a {color:var(--color-text-sub);transition:all 0.5s cubic-bezier(0.34,1.56,0.64,1);}
.sidebar-social a:hover {color:var(--color-green);transform:translateY(-4px) scale(1.3);text-shadow:0 0 10px var(--hover-glow);}
.sidebar-menu-link-wrap {margin:15px 0;}
.sidebar-menu-link {color:var(--color-text-sub);font-size:15px;padding:8px 0;display:block;transition:all 0.4s cubic-bezier(0.34,1.56,0.64,1);font-weight:var(--font-weight-normal);}
.sidebar-menu-link:hover {color:var(--color-green);padding-left:8px;transform:translateX(2px);font-weight:var(--font-weight-bold);}
.sidebar-stat-wrap {
    padding: 0px 0;
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(255,255,255,0.05);
}
html[data-theme-mode="light"] .sidebar-stat-wrap {
    background: rgba(255, 255, 255, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.8);
}
.stat-item {
    text-align: center; 
    flex: 1; 
    user-select: none;
    pointer-events: none;
}
.sidebar-stat-title {
    font-size: 15px;
    font-weight: var(--font-weight-bold);
    color: var(--color-green);
    margin-bottom: 10px;
    padding-bottom: 6px;
    border-bottom: 1px solid rgba(56,161,105,0.1);
    text-align: center;
}
.sidebar-stat-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 6px 0;
    font-size: 14px;
}
.stat-icon {
    width: 20px;
    text-align: center;
}
.stat-text {
    font-size: 12px;
    color: var(--color-text-sub);
}
.stat-num {
    font-size: 22px;
    font-weight: var(--font-weight-bold);
    color: var(--color-green);
    margin-bottom: -5px;
}
.sidebar-update-log {
    margin-top:3px;padding:16px;padding-top:5px;background:transparent;border-radius:16px;border:1px solid rgba(255,255,255,0.08);max-height:220px;overflow-y:auto;overflow-x:hidden;scrollbar-width:none;-ms-overflow-style:none;backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);
}
html[data-theme-mode="light"] .sidebar-update-log {
    background: rgba(255, 255, 255, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(10px) saturate(180%);
    -webkit-backdrop-filter: blur(10px) saturate(180%);
}
.sidebar-update-log::-webkit-scrollbar {display:none;}
.update-log-title {font-size:15px;font-weight:var(--font-weight-bold);color:var(--color-green);margin-bottom:12px;padding-bottom:6px;border-bottom:1px solid rgba(56,161,105,0.1);}
.update-log-version {font-size:14px;font-weight:var(--font-weight-bold);color:var(--color-text-title);margin:10px 0 4px 0;}
.update-log-content {font-size:13px;color:var(--color-text-sub);padding-left:15px;line-height:1.7;font-weight:var(--font-weight-light);}
.update-log-time {margin-top:15px;padding-top:10px;border-top:1px solid var(--border-color-light);font-size:12px;color:var(--color-text-sub);text-align:center;}
#content {
  flex: 1;
  width: 100%;
  position:relative;
  z-index:6;
  margin: 0 auto;
  text-align: center;
}
#main {
  flex:1;
  position:relative;
  z-index:6;
  max-width: 100%;
  margin: 0 auto;
}
.article-inner {
    background: var(--glass-bg);
    border-radius: 20px;
    padding: 30px 35px 35px 35px;
    margin-bottom: 25px;
    box-shadow: var(--glass-shadow), inset 1px 1px 0 var(--glass-inset-light), inset -1px -1px 0 var(--glass-inset-dark);
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(12px) saturate(180%) contrast(1.1);
    -webkit-backdrop-filter: blur(12px) saturate(180%) contrast(1.1);
    position: relative;
    transition: all 0.3s ease;
    margin: 15px auto 25px auto;
}
html[data-theme-mode="light"] .article-inner {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(25px) saturate(200%) contrast(1.1);
    -webkit-backdrop-filter: blur(25px) saturate(200%) contrast(1.1);
    border: 1px solid rgba(255, 255, 255, 0.9);
    box-shadow: 
        0 20px 60px rgba(45, 180, 141, 0.08),
        0 10px 30px rgba(0, 0, 0, 0.03),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05);
}
.article-inner .search-box-container {
    width: 100%;
    display: flex;
    gap: 10px;
    margin: 25px 0 0 0;
    align-items:center;
    justify-content:center;
}
.article-inner:hover {box-shadow:0 10px 30px rgba(0,0,0,0.08),0 0 20px var(--hover-glow);}
html[data-theme-mode="light"] .article-inner:hover {
    box-shadow: 
        0 25px 70px rgba(45, 180, 141, 0.12),
        0 15px 40px rgba(0, 0, 0, 0.05),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95);
}
.article-title {font-size:28px;text-align:center;color:var(--color-text-title);margin-bottom:15px;font-weight:var(--font-weight-bold);letter-spacing:1px;}
.article-signature {text-align:center;line-height:2;font-size:16px;color:var(--color-text-sub);padding:0 10px;font-weight:var(--font-weight-light);}
.search-box-container {width:100%;display:flex;gap:10px;align-items:center;justify-content:center;}
.search-input {
    flex:1;height:42px;background:transparent;border:1px solid rgba(255,255,255,0.1);border-radius:12px;padding:0 20px;color:var(--color-text-main);font-size:15px;outline:none;transition:all 0.3s ease;backdrop-filter:blur(10px) saturate(150%);-webkit-backdrop-filter:blur(10px) saturate(150%);box-shadow:inset 1px 1px 0 var(--glass-inset-light),inset -1px -1px 0 var(--glass-inset-dark);font-family:var(--font-family-main);
}
html[data-theme-mode="light"] .search-input {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(218, 218, 218, 0.9);
    box-shadow: 
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05),
        0 2px 4px rgba(0, 0, 0, 0.02);
}
.search-input::placeholder {color:var(--color-text-sub);font-size:14px;font-weight:var(--font-weight-light);}
.search-input:focus {border-color:rgba(56,161,105,0.4);box-shadow:0 0 15px var(--hover-glow),inset 1px 1px 0 var(--glass-inset-light),inset -1px -1px 0 var(--glass-inset-dark);}
html[data-theme-mode="light"] .search-input:focus {
    border-color: var(--color-green);
    box-shadow: 
        0 0 0 3px rgba(45, 180, 141, 0.15),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95);
}
.search-btn {
    height:42px;padding:0 25px;background:transparent;border:1px solid var(--glass-border);border-radius:12px;color:var(--color-green);font-size:15px;cursor:pointer;transition:all 0.4s cubic-bezier(0.34,1.56,0.64,1);display:flex;align-items:center;justify-content:center;backdrop-filter:blur(10px) saturate(180%);-webkit-backdrop-filter:blur(10px) saturate(180%);box-shadow:var(--glass-shadow),inset 1px 1px 0 var(--glass-inset-light),inset -1px -1px 0 var(--glass-inset-dark);font-weight:var(--font-weight-medium);
}
html[data-theme-mode="light"] .search-btn {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.9);
    color: var(--color-green);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.04),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05);
}
.search-btn:hover {background:rgba(56,161,105,0.08);transform:translateY(-3px) scale(1.02);border-color:rgba(56,161,105,0.4);box-shadow:0 8px 20px var(--hover-glow),inset 1px 1px 0 var(--glass-inset-light),inset -1px -1px 0 var(--glass-inset-dark);}
html[data-theme-mode="light"] .search-btn:hover {
    background: rgba(45, 180, 141, 0.12);
    color: var(--color-green-deep);
    border-color: var(--color-green);
    box-shadow: 
        0 8px 20px var(--hover-glow),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95);
}
.search-btn:active {transform:translateY(0) scale(var(--active-scale));box-shadow:0 2px 8px rgba(56,161,105,0.1) !important;}
.search-empty-tips {text-align:center;color:var(--color-text-sub);padding:40px 20px;font-size:15px;width:100%;font-weight:var(--font-weight-light);}

.news-container {width:100%;display:flex;flex-direction:column-reverse;gap:20px;position:relative;z-index:999;}
.news-item {
    background: var(--glass-bg);border-radius:35px;border:1px solid var(--glass-border);
    box-shadow:var(--glass-shadow),inset 1px 1px 0 var(--glass-inset-light),inset -1px -1px 0 var(--glass-inset-dark);
    padding:25px;position:relative;z-index:9999;color:var(--color-text-main);margin-bottom:4px;width:100%;overflow:hidden;
    transition:all 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
    opacity: 0;
    will-change: transform, opacity;
    display:flex;justify-content:space-between;gap:20px;align-items:flex-start;
    backdrop-filter: blur(12px) saturate(180%) contrast(1.1);-webkit-backdrop-filter: blur(12px) saturate(180%) contrast(1.1);
}
html[data-theme-mode="light"] .news-item {
    background: rgba(255, 255, 255, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(25px) saturate(200%) contrast(1.1);
    -webkit-backdrop-filter: blur(25px) saturate(200%) contrast(1.1);
    box-shadow: 
        0 15px 50px rgba(45, 180, 141, 0.06),
        0 8px 20px rgba(0, 0, 0, 0.03),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05);
}
.news-item.active {
    transform: translate3d(0, 0, 0);
    opacity: 1;
}
.news-item.out {
    opacity: 0;
}
.news-item:nth-child(even) {flex-direction: row;}
.news-item:nth-child(odd) {flex-direction: row-reverse;justify-content: space-between;}
.news-item.out:nth-child(odd) {
    transform: translate3d(-100%, 0, 0);
}
.news-item.out:nth-child(even) {
    transform: translate3d(100%, 0, 0);
}
.news-text-box {flex:0 0 60%;display:flex;flex-direction:column;justify-content:space-between;min-height:200px;}
.news-media-box {flex:0 0 35%;height:200px;border-radius:12px;overflow:hidden;border:1px solid rgba(56,161,105,0.08);box-shadow:0 3px 10px rgba(0,0,0,0.05);}
html[data-theme-mode="light"] .news-media-box {
    border: 1px solid rgba(255, 255, 255, 0.8);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.04),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95);
}
.news-item:hover {
    transform: translateY(-6px) scale(1.01) translateZ(0) rotate(0deg) !important;
    box-shadow:0 15px 35px rgba(0,0,0,0.12), 0 0 30px var(--hover-glow),inset 1px 1px 0 var(--glass-inset-light),inset -1px -1px 0 var(--glass-inset-dark);
    border-color: rgba(56,161,105,0.2);
    opacity: 1 !important;
}
html[data-theme-mode="light"] .news-item:hover {
    transform: translateY(-8px) scale(1.01) translateZ(0) rotate(0deg) !important;
    box-shadow: 
        0 25px 70px rgba(45, 180, 141, 0.12),
        0 15px 40px rgba(0, 0, 0, 0.06),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95);
    border-color: var(--color-green);
    background: rgba(255, 255, 255, 0.85);
}
.news-title {font-size:24px;color:var(--color-text-title)!important;font-weight:var(--font-weight-bold);margin-bottom:12px;letter-spacing:1px;cursor:pointer;transition: all 0.3s ease;}
.news-title:hover {color:var(--color-green)!important;}
.news-content {font-size:17px;color:var(--color-text-main)!important;line-height:1.9;font-weight:var(--font-weight-normal);}
.news-date {
    font-size: 13px;
    color: var(--color-green);
    opacity: 0.95;
    z-index: 10;
    pointer-events: none;
    margin-top: auto;
    padding-top: 10px;
    font-weight: var(--font-weight-light);
    display: flex;
    align-items: center;
    gap: 8px;
}
.news-img-item, .news-video-item {width:100%;height:100%;object-fit:cover;object-position:center;cursor:pointer;transition:all 0.3s ease;display:block;}
.news-img-item:hover, .news-video-item:hover {transform:scale(1.03);box-shadow:0 0 12px var(--hover-glow);}
.news-loading {text-align:center;color:var(--color-green);padding:40px 20px;font-size:15px;}
.comment-area {margin-top:15px;padding-top:15px;border-top:1px solid rgba(255,255,255,0.08);width:100%;display:none;}
.comment-title {display:none;}
.utter-container {opacity:0;visibility:hidden;max-height:0;overflow:hidden;}

.news-like-btn {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    color: var(--color-green);
    font-size: 16px;
    padding: 2px 6px;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
    transition: all 0.2s ease;
    font-weight: var(--font-weight-medium);
    pointer-events: auto;
}
.news-like-btn:hover {
    color: var(--color-green-deep);
    transform: scale(1.05);
}
.news-like-btn.liked {
    color: var(--color-green) !important;
}
.news-like-count {
    font-size: 12px;
    font-weight: var(--font-weight-medium);
}
.modal-news-like-btn {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    color: var(--color-green);
    font-size: 14px;
    padding: 2px 6px;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
    transition: all 0.2s ease;
    font-weight: var(--font-weight-medium);
    pointer-events: auto;
}
.modal-news-like-btn:hover {
    color: var(--color-green-deep);
    transform: scale(1.05);
}
.modal-news-like-btn.liked {
    color: var(--color-green) !important;
}
.modal-news-like-count {
    font-size: 11px;
    font-weight: var(--font-weight-medium);
}
.toast-notification {
    position: fixed;
    top: 80px;
    right: 20px;
    background: var(--glass-bg);
    backdrop-filter: blur(12px) saturate(180%);
    -webkit-backdrop-filter: blur(12px) saturate(180%);
    border: 1px solid var(--glass-border);
    border-radius: 8px;
    padding: 10px 18px;
    color: var(--color-text-main);
    font-size: 14px;
    box-shadow: var(--glass-shadow);
    z-index: 999999;
    opacity: 0;
    transform: translateX(100%);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: flex;
    align-items: center;
    gap: 8px;
}

.toast-notification.show {
    opacity: 1;
    transform: translateX(0);
}

.toast-notification .icon {
    color: var(--color-green);
    font-size: 16px;
    font-weight: bold;
}
.toast-notification .loading-spinner {
  width: 16px;
  height: 16px;
  border: 2px solid var(--color-green);
  border-top-color: transparent;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.toast-notification .success-icon {
  font-size: 16px;
  font-weight: bold;
  color: var(--color-green);
}
.tip-modal-mask {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    z-index: 99999;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: all 0.4s cubic-bezier(0.34,1.56,0.64,1);
    padding: 20px 10px;
    box-sizing: border-box;
}
.tip-modal-mask.show {
    opacity: 1;
    pointer-events: all;
}
.tip-modal-box {
    width: 100%;
    max-width: 380px;
    padding: 25px 20px;
    border-radius: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 15px;
    transform: translateY(15px) scale(0.95);
    transition: all 0.4s cubic-bezier(0.34,1.56,0.64,1);
}
.tip-modal-mask.show .tip-modal-box {
    transform: translateY(0) scale(1);
}
.tip-modal-icon {
    font-size: 32px;
    color: #ffffff !important;
    font-weight: bold;
}
.tip-modal-text {
    font-size: 16px;
    color: rgba(255, 255, 255, 0.98) !important;
    text-align: center;
    font-weight: var(--font-weight-medium);
    line-height: 1.6;
}
.tip-modal-close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: transparent;
    border: none;
    cursor: pointer;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.5s cubic-bezier(0.34,1.56,0.64,1);
    backdrop-filter: blur(8px) saturate(180%);
    -webkit-backdrop-filter: blur(8px) saturate(180%);
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow:0 2px 8px rgba(0,0,0,0.08),inset 1px 1px 0 rgba(255,255,255,0.1),inset -1px -1px 0 rgba(0,0,0,0.05);
    color: var(--color-green);
}
.tip-modal-close-btn:hover {
    background:rgba(56,161,105,0.15);
    color:#fff;
    transform:rotate(120deg) scale(1.1);
    box-shadow:0 0 15px var(--hover-glow);
    border-color:rgba(56,161,105,0.3);
}
.tip-modal-close-btn:active {
    transform: rotate(90deg) scale(var(--active-scale));
}
#bgModalMask {
    padding: 20px !important;
    align-items: flex-start !important;
    overflow-y: auto !important;
}
#bgModalMask .tip-modal-box {
    padding: 15px !important;
    margin: 0 auto !important;
    margin-top: 15px !important;
    top: 0 !important;
    left: 0 !important;
    transform: none !important;
    width: 95% !important;
    max-width: 1200px !important;
    max-height: 90vh !important;
    overflow: hidden !important;
    box-sizing: border-box !important;
}
#bgModalMask .tip-modal-box > div:first-child,
#bgModalMask .tip-modal-box > div:nth-child(2),
#bgModalMask .tip-modal-box > div:nth-child(3) {
    padding: -1px 0 8px 0 !important;
    margin: 0 !important;
    width: 100% !important;
}
#bgThumbList .bg-thumb-item {
    width: 100% !important;
    height: 110px !important;
    margin: 0 !important;
    padding: 0 !important;
    border-radius: 10px !important;
    overflow: hidden !important;
    box-sizing: border-box !important;
}
#bgThumbList .bg-thumb-item img {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
    display: block !important;
}
#bgThumbList {
    width: 100% !important;
    height: auto !important;
    margin: 0px !important;
    padding: 0px !important;
    padding-top: 0 !important;
    display: grid !important;
    grid-template-columns: repeat(4, 1fr) !important;
    gap: 12px !important;
    overflow-x: hidden !important;
    overflow-y: auto !important;
    position: relative !important;
    top: 0 !important;
    left: 0 !important;
    max-height: calc(85vh - 120px) !important;
}
.bg-tab-group {
    display: flex;
    gap: 10px;
    margin: 8px 0 15px 0;
    width: 100%;
}
.bg-tab-btn {
    flex: 1;
    height: 38px;
    background: transparent;
    border: 1px solid var(--glass-border);
    border-radius: 10px;
    color: var(--color-text-sub);
    font-size: 15px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.34,1.56,0.64,1);
    backdrop-filter: blur(10px) saturate(180%);
    -webkit-backdrop-filter: blur(10px) saturate(180%);
    font-weight: var(--font-weight-medium);
}
html[data-theme-mode="light"] .bg-tab-btn {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.9);
    color: var(--color-text-main);
    box-shadow: 
        0 2px 6px rgba(0, 0, 0, 0.04),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95);
}
.bg-tab-btn.active {
    color: #fff !important;
    background: linear-gradient(145deg, rgba(56,161,105,0.2), rgba(45,139,105,0.15)) !important;
    border-color: rgba(56, 161, 105, 0.5) !important;
    font-weight: var(--font-weight-bold);
    box-shadow: 0 4px 15px var(--hover-glow);
}
html[data-theme-mode="light"] .bg-tab-btn.active {
    background: linear-gradient(135deg, var(--color-green), var(--color-green-deep)) !important;
    border-color: var(--color-green) !important;
    box-shadow: 
        0 4px 15px rgba(45, 180, 141, 0.25),
        0 2px 8px rgba(0, 0, 0, 0.05);
}
.bg-tab-btn:hover:not(.active) {
    color: var(--color-green) !important;
    background: rgba(56, 161, 105, 0.08) !important;
    border-color: rgba(56,161,105,0.4) !important;
    box-shadow: 0 4px 12px var(--hover-glow);
}
html[data-theme-mode="light"] .bg-tab-btn:hover:not(.active) {
    background: rgba(45, 180, 141, 0.12) !important;
    border-color: var(--color-green) !important;
    color: var(--color-green-deep) !important;
    box-shadow: 0 4px 12px rgba(45, 180, 141, 0.15);
}
.bg-thumb-item {
    width: 100% !important;
    height: 90px !important;
    border-radius: 10px !important;
    overflow: hidden !important;
    cursor: pointer !important;
    border: 2px solid transparent !important;
    transition: all 0.25s ease !important;
    position: relative !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
    background: rgba(0,0,0,0.1) !important;
}
html[data-theme-mode="light"] .bg-thumb-item {
    background: rgba(255, 255, 255, 0.9) !important;
    border: 1px solid rgba(255, 255, 255, 0.9) !important;
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.05),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95) !important;
}
.bg-thumb-item:hover {
    transform: scale(1.03) !important;
    box-shadow:0 0 15px var(--hover-glow) !important;
}
html[data-theme-mode="light"] .bg-thumb-item:hover {
    box-shadow: 0 8px 25px rgba(45, 180, 141, 0.15) !important;
}
.bg-thumb-item.active {
    border-color:var(--color-green) !important;
    box-shadow:0 0 20px var(--hover-glow) !important;
}
html[data-theme-mode="light"] .bg-thumb-item.active {
    border-color: var(--color-green) !important;
    box-shadow: 
        0 0 0 3px rgba(45, 180, 141, 0.15),
        0 8px 25px rgba(45, 180, 141, 0.2) !important;
}
.bg-thumb-item img {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
    object-position: center !important;
    display: block !important;
    opacity: 1 !important;
}
.bg-thumb-del {
    position:absolute;
    top:5px;
    right:5px;
    width:24px;
    height:24px;
    border-radius:50%;
    background:rgba(0,0,0,0.8);
    color:#fff;
    font-size:12px;
    display:flex;align-items:center;justify-content:center;
    cursor:pointer;
    opacity:0;
    transition:opacity 0.25s ease;
    z-index: 99;
}
.bg-thumb-item:hover .bg-thumb-del {
    opacity:1;
}
#bgModalCloseBtn {
    position: fixed !important;
    top: 15px !important;
    right: 15px !important;
    width: 45px !important;
    height: 45px !important;
    font-size: 20px !important;
    z-index: 9999999 !important;
}

.img-preview-mask {position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.95);z-index:10000;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.4s cubic-bezier(0.16,1,0.3,1);}
.img-preview-mask.show {opacity:1;pointer-events:all;}
.preview-img, .preview-video {
    max-width:90vw;
    max-height:90vh;
    border-radius:8px;
    transform-origin:center center;
    transform:scale(0.95);
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.34,1.56,0.64,1);
    display:none;
    object-fit:contain;
    margin:0 auto;
}
.preview-img.show-animate, .preview-video.show-animate {
    transform:scale(1);
    opacity: 1;
}
.preview-img {z-index:10001;}
.preview-video {z-index:10001;background:#000;}
.img-preview-mask.show .preview-img, .img-preview-mask.show .preview-video {display:block;transform:scale(1);}
.preview-close-btn {
    position: fixed;
    top: 25px;
    right: 25px;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: transparent;
    border: none;
    cursor: pointer;
    font-size: 20px;
    display:flex;align-items:center;justify-content:center;
    z-index: 10002;
    backdrop-filter: blur(8px) saturate(180%);
    -webkit-backdrop-filter: blur(8px) saturate(180%);
    border:1px solid rgba(255,255,255,0.08);
    box-shadow:0 2px 8px rgba(0,0,0,0.08),inset 1px 1px 0 rgba(255,255,255,0.1),inset -1px -1px 0 rgba(0,0,0,0.05);
    color: var(--color-green);
}
.preview-close-btn:hover {
    background:rgba(56,161,105,0.15);
    color:#fff;
    transform:rotate(120deg) scale(1.2);
    box-shadow:0 0 15px var(--hover-glow);
    border-color:rgba(56,161,105,0.3);
}
.preview-nav-btn {
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: transparent;
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--color-green);
    font-size: 20px;
    cursor: pointer;
    z-index: 10003;
    backdrop-filter: blur(8px) saturate(180%);
    -webkit-backdrop-filter: blur(8px) saturate(180%);
    box-shadow: 0 2px 8px rgba(0,0,0,0.08),
                inset 1px 1px 0 rgba(255,255,255,0.1),
                inset -1px -1px 0 rgba(0,0,0,0.05);
    transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
}
.preview-prev-btn {
    left: 30px;
}
.preview-next-btn {
    right: 30px;
}
.preview-nav-btn:hover {
    background: rgba(56,161,105,0.15);
    color: #fff;
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 0 15px var(--hover-glow);
    border-color: rgba(56,161,105,0.3);
}
.preview-nav-btn:active {
    transform: translateY(-50%) scale(var(--active-scale));
}
.preview-nav-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    transform: translateY(-50%);
    box-shadow: none;
}
.preview-pagination {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    padding: 6px 16px;
    background: rgba(0,0,0,0.6);
    border-radius: 20px;
    color: #fff;
    font-size: 14px;
    font-weight: var(--font-weight-medium);
    z-index: 10003;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
}
html[data-theme-mode="light"] .preview-nav-btn {
    background: rgba(255,255,255,0.8);
    border: 1px solid rgba(255,255,255,0.9);
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}
html[data-theme-mode="light"] .preview-nav-btn:hover {
    background: var(--color-green);
    border-color: var(--color-green);
}
html[data-theme-mode="light"] .preview-pagination {
    background: rgba(255,255,255,0.8);
    color: var(--color-text-title);
    border: 1px solid rgba(255,255,255,0.9);
}
.news-modal-mask {position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);z-index:9999;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.4s cubic-bezier(0.16,1,0.3,1);padding:20px;box-sizing:border-box;}
.news-modal-mask.show {opacity:1;pointer-events:all;}
.news-modal-box {background:var(--glass-bg);border-radius:20px;border:1px solid var(--glass-border);box-shadow:0 12px 48px rgba(0,0,0,0.15),inset 1px 1px 0 var(--glass-inset-light),inset -1px -1px 0 var(--glass-inset-dark);width:100%;max-width:800px;max-height:calc(100vh - 40px);color:var(--color-text-main);position:relative;transform:translateY(20px);transition:transform 0.4s cubic-bezier(0.34,1.56,0.64,1),opacity 0.4s cubic-bezier(0.34,1.56,0.64,1);opacity:0;overflow-y:auto;overflow-x:hidden;margin:auto;backdrop-filter:blur(20px) saturate(180%) contrast(1.1);-webkit-backdrop-filter:blur(20px) saturate(180%) contrast(1.1);}
html[data-theme-mode="light"] .news-modal-box {
    background: rgba(255, 255, 255, 0.85);
    border: 1px solid rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(30px) saturate(200%) contrast(1.1);
    -webkit-backdrop-filter: blur(30px) saturate(200%) contrast(1.1);
    box-shadow: 
        0 25px 80px rgba(45, 180, 141, 0.1),
        0 15px 40px rgba(0, 0, 0, 0.05),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05);
}
.news-modal-mask.show .news-modal-box {transform:translateY(0);opacity:1;}
.modal-close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: transparent;
    border: none;
    cursor: pointer;
    font-size: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.5s cubic-bezier(0.34,1.56,0.64,1);
    z-index: 99999;
    backdrop-filter: blur(8px) saturate(180%);
    -webkit-backdrop-filter: blur(8px) saturate(180%);
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow:0 2px 8px rgba(0,0,0,0.08),inset 1px 1px 0 rgba(255,255,255,0.1),inset -1px -1px 0 rgba(0,0,0,0.05);
    color: var(--color-green);
    margin: 0;
    padding: 0;
}
.modal-close-btn:hover {background:rgba(56,161,105,0.15);color:#fff;transform:rotate(120deg) scale(1.2);box-shadow:0 0 15px var(--hover-glow);border-color:rgba(56,161,105,0.3);}
.modal-close-btn:active {transform: rotate(90deg) scale(var(--active-scale));}
.modal-news-content {
    padding:45px 30px 25px 30px;
    width: 60%; 
    overflow-y: auto;
    max-height: calc(100vh - 90px);
    box-sizing: border-box;
    overscroll-behavior: contain;
    scrollbar-width: thin;
}
.modal-news-title {font-size:25px;color:var(--color-text-title);font-weight:var(--font-weight-bold);margin-bottom:15px;letter-spacing:1px;}
.modal-news-desc {font-size:17px;color:var(--color-text-main);line-height:1.9;margin-bottom:20px;font-weight:var(--font-weight-normal);}
.modal-news-imgs {display:flex;flex-wrap:wrap;gap:12px;margin-bottom:15px;}
.modal-news-img-item {width:calc(33.33% - 8px);height:180px;object-fit:cover;border-radius:8px;border:1px solid rgba(56,161,105,0.08);cursor:pointer;transition:all 0.3s ease;position:relative;}
.modal-news-img-item:hover {transform:scale(1.03);box-shadow:0 0 12px var(--hover-glow);}
.modal-news-date {
    font-size: 12px;
    color: var(--color-text-sub);
    text-align: right;
    margin-bottom: 20px;
    font-weight: var(--font-weight-light);
    display: flex;
    align-items: center;
    gap: 8px;
    justify-content: flex-end;
}
.modal-comment-area {
    padding:0 30px 25px 30px;
    border-top:1px solid rgba(255,255,255,0.08);
    margin-top:10px;
    width: 40%;
    overflow-y: auto;
    max-height: calc(100vh - 90px);
    box-sizing: border-box;
    border-left:1px solid rgba(255,255,255,0.08);
    border-top: none;
    margin-top: 0;
    overscroll-behavior: contain;
    scrollbar-width: thin;
}
html[data-theme-mode="light"] .modal-comment-area {
    border-left:1px solid rgba(0,0,0,0.08);
}
.modal-utter-container {width:100%!important;min-height:200px;max-height:400px;}
.modal-utter-container iframe {width:100%!important;border:0!important;min-height:200px!important;}
.news-modal-box::-webkit-scrollbar {display:none;}
.news-modal-box {-ms-overflow-style:none;scrollbar-width:none;}
.news-modal-box {color: #ffffff !important;}
.news-modal-box .modal-news-title,.news-modal-box .modal-news-desc,.news-modal-box .modal-news-date {color: #ffffff !important;}
#footer {
    width: auto;
    height: 50px;
    color: var(--color-text-sub);
    background: var(--glass-bg);
    position: fixed;
    bottom: 15px;
    left: 15px;
    transform: translateX(0);
    z-index: 98;
    display: flex;
    align-items: center;
    padding: 0;
    border-radius: 25px;
    backdrop-filter: blur(12px) saturate(180%) contrast(1.1);
    -webkit-backdrop-filter: blur(12px) saturate(180%) contrast(1.1);
    box-shadow: var(--glass-shadow),inset 1px 1px 0 var(--glass-inset-light),inset -1px -1px 0 var(--glass-inset-dark);
    transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    overflow: hidden;
}
html[data-theme-mode="light"] #footer {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(20px) saturate(200%);
    -webkit-backdrop-filter: blur(20px) saturate(200%);
    box-shadow: 
        0 15px 50px rgba(45, 180, 141, 0.08),
        0 8px 20px rgba(0, 0, 0, 0.03),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05);
}
#footer.music-paused {
    width: 50px;
    border-radius: 50%;
}

#footer.music-playing {
    width: 200px;
    border-radius: 25px;
}
#footer:hover {box-shadow:0 8px 25px rgba(0,0,0,0.08),0 0 15px var(--hover-glow);}
html[data-theme-mode="light"] #footer:hover {
    box-shadow: 
        0 20px 60px rgba(45, 180, 141, 0.12),
        0 10px 30px rgba(0, 0, 0, 0.05),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95);
}
#footer a {color:var(--color-green);transition: color 0.2s ease;font-weight:var(--font-weight-medium);}
#footer a:hover {text-decoration:underline;color:var(--color-green-deep);}
.footer-right {display:flex;align-items:center;gap:8px;margin:0 auto;}
.music-player {
    display: flex;
    align-items: center;
    gap: 10px;
    position: relative;
    left: 0;
    top: 0;
    transform: none;
    padding: 0 15px;
    width: 100%;
    height: 100%;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}
#footer.music-paused .music-text {
    opacity: 0;
    width: 0;
    overflow: hidden;
    margin-left: -10px;
}

#footer.music-playing .music-text {
    opacity: 1;
    width: auto;
    margin-left: 0;
}
.music-btn {
    width: 38px;
    height: 38px;
    border-radius: 50%;
    background: transparent;
    color: var(--color-green);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.5s cubic-bezier(0.34,1.56,0.64,1);
    font-size: 16px;
    position: relative;
    backdrop-filter: blur(8px) saturate(180%);
    -webkit-backdrop-filter: blur(8px) saturate(180%);
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow:0 3px 10px rgba(0,0,0,0.08),inset 1px 1px 0 rgba(255,255,255,0.1),inset -1px -1px 0 rgba(0,0,0,0.05);
    flex-shrink: 0;
    overflow: hidden;
    z-index: 100;
}
html[data-theme-mode="light"] .music-btn {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.9);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.05),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05);
}
.music-btn:hover {background:var(--color-green-deep);color:#fff;transform:scale(1.2);border-color:var(--color-green-deep);box-shadow:0 0 20px var(--hover-glow);}
html[data-theme-mode="light"] .music-btn:hover {
    background: var(--color-green);
    color: #fff;
    border-color: var(--color-green);
    box-shadow: 0 0 25px rgba(45, 180, 141, 0.3);
}
.music-btn:active {transform: scale(var(--active-scale));}
.play-icon::before {content:'';width:0;height:0;border-top:8px solid transparent;border-bottom:8px solid transparent;border-left:13px solid currentColor;margin-left:2px;}
.pause-icon::before {content:'';width:12px;height:14px;background:linear-gradient(to right, currentColor 0, currentColor 3px, transparent 3px, transparent 6px, currentColor 6px, currentColor 9px);}
.music-text {font-size:12px;color:var(--color-text-sub);font-weight:var(--font-weight-light);}
audio {display:none;}
.sidebar-top {position:fixed;bottom:90px;right:30px;z-index:99;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.5s cubic-bezier(0.34,1.56,0.64,1);border:1px solid var(--glass-border);background:transparent;backdrop-filter:blur(12px) saturate(180%);-webkit-backdrop-filter:blur(12px) saturate(180%);box-shadow:var(--glass-shadow),inset 1px 1px 0 var(--glass-inset-light),inset -1px -1px 0 var(--glass-inset-dark);color: var(--color-text-sub);}
html[data-theme-mode="light"] .sidebar-top {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.9);
    box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.08),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05);
}
.sidebar-top:hover {background:var(--color-green);color:#fff;transform:translateY(-6px) scale(1.2);box-shadow:0 0 25px var(--hover-glow);border-color: var(--color-green);}
html[data-theme-mode="light"] .sidebar-top:hover {
    background: var(--color-green);
    color: #fff;
    border-color: var(--color-green);
    box-shadow: 0 0 30px rgba(45, 180, 141, 0.3);
}
.sidebar-top:active {transform: translateY(0) scale(var(--active-scale));}
.sidebar-tools {position:fixed;bottom:140px;right:30px;z-index:99;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.5s cubic-bezier(0.34,1.56,0.64,1);border:1px solid var(--glass-border);background:transparent;backdrop-filter:blur(12px) saturate(180%);-webkit-backdrop-filter:blur(12px) saturate(180%);font-size:18px;color: var(--color-text-sub);box-shadow:var(--glass-shadow),inset 1px 1px 0 var(--glass-inset-light),inset -1px -1px 0 var(--glass-inset-dark);}
html[data-theme-mode="light"] .sidebar-tools {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.9);
    box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.08),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05);
}
.sidebar-tools:hover {background:var(--color-green);color:#fff;transform:translateY(-6px) scale(1.2);box-shadow:0 0 25px var(--hover-glow);border-color: var(--color-green);}
html[data-theme-mode="light"] .sidebar-tools:hover {
    background: var(--color-green);
    color: #fff;
    border-color: var(--color-green);
    box-shadow: 0 0 30px rgba(45, 180, 141, 0.3);
}
.sidebar-tools:active {transform: translateY(0) scale(var(--active-scale));}
::-webkit-scrollbar {width:8px;height:8px;}
::-webkit-scrollbar-track {background:var(--scrollbar-track);border-radius:10px;}
::-webkit-scrollbar-thumb {background:var(--scrollbar-thumb);border-radius:10px;transition:all 0.2s ease;}
::-webkit-scrollbar-thumb:hover {background:var(--color-green);}
::-webkit-scrollbar-thumb:active {background:var(--color-green-deep);}
.sidebar-wrap::-webkit-scrollbar { width: 6px; }
@media (max-width: 1024px) {
    #footer.music-playing {
        width: 160px;
    }
    .music-text {
        font-size: 11px;
    }
    .news-modal-box {
        flex-direction: column;
        max-width: 100%;
    }
    .modal-news-content {
        width: 100%;
        height: auto;
        max-height: 50vh;
        overflow-y: auto;
        overscroll-behavior: contain;
    }
    .modal-comment-area {
        width: 100%;
        height: auto;
        max-height: 40vh;
        overflow-y: auto;
        border-left: none;
        border-top:1px solid rgba(255,255,255,0.08);
        margin-top: 10px;
        overscroll-behavior: contain;
    }
    html[data-theme-mode="light"] .modal-comment-area {
        border-top:1px solid rgba(0,0,0,0.08);
    }
    html, body {overflow-x:hidden!important;}
    .container-main {flex-direction:column;gap:30px;margin:20px auto;}
    #sidebar {position:static;width:100%;left:auto;top:auto;transform:none;margin-bottom:0;height:auto;}
    #content {width:100%;margin-left:0!important;padding:0!important;}
    .sidebar-wrap {max-height:none;overflow-y:visible;}
    .article-title {font-size:24px;}
    .main-nav-link-wrap {margin:0 6px;}
    .sidebar-top {bottom:80px;right:20px;}
    .sidebar-tools {bottom:130px;right:20px;}
    #footer {width:calc(100% - 30px);left:15px;bottom:10px;padding:12px 15px;height:auto;flex-wrap:wrap;gap:8px;justify-content:center;}
    .music-text {display:none;}
    .news-item {flex-direction:column;gap:15px;padding:20px;}
    .news-text-box {flex:1;min-height:auto;}
    .news-media-box {flex:1;width:100%;height:180px;}
    .news-title {font-size:20px;}
    .news-content {font-size:15px;}
    .github-login-btn, .user-name-display {border-radius:24px !important;padding:9px 18px !important;}
    .news-modal-box {max-width:100%;margin:20px 0;}
    .modal-news-img-item {width:calc(50% - 8px);height:150px;}
    .modal-news-content {padding:20px 18px;}
    .modal-comment-area {padding:0 18px 20px 18px;}
    .search-box-container {padding:0 5px;}
    .search-input {height:38px;font-size:14px;}
    .search-btn {height:38px;padding:0 25px;font-size:14px;justify-content:center;}
    .search-btn .iconfont {margin-right:6px;}
}
@media (max-width:768px) {
    .news-media-box {height:160px;}
    .modal-news-img-item {width:100%;height:200px;}
    .nav-center {flex-wrap:wrap;gap:8px;}
    #header-nav {width:calc(100% - 20px);margin:10px auto 0 auto;padding:10px 15px;}
}
* {
    max-width: 100%;
    box-sizing: border-box;
}
.news-modal-box {
    background:var(--glass-bg);
    border-radius:20px;
    border:1px solid var(--glass-border);
    box-shadow:0 12px 48px rgba(0,0,0,0.15),inset 1px 1px 0 var(--glass-inset-light),inset -1px -1px 0 var(--glass-inset-dark);
    width:100%;
    max-width: 1200px;
    max-height:calc(100vh - 40px);
    color:var(--color-text-main);
    position:relative;
    transform:translateY(20px);
    transition:transform 0.4s cubic-bezier(0.34,1.56,0.64,1),opacity 0.4s cubic-bezier(0.34,1.56,0.64,1);
    opacity:0;
    display: flex;
    flex-direction: row;
    overflow: hidden;
    margin:auto;
    backdrop-filter:blur(20px) saturate(180%) contrast(1.1);
    -webkit-backdrop-filter:blur(20px) saturate(180%) contrast(1.1);
}
img, video, iframe {
    max-width: 100%;
    height: auto;
}
table {
    max-width: 100%;
    overflow-x: auto;
    display: block;
}
.qq-login-btn, .user-info-display {
    padding:8px 12px;font-size:14px;color:var(--color-text-sub);background:transparent;border:1px solid rgba(255,255,255,0.08);border-radius:20px;cursor:pointer;transition:all 0.4s cubic-bezier(0.34,1.56,0.64,1);display:flex;align-items:center;gap:6px;backdrop-filter:blur(8px) saturate(180%);-webkit-backdrop-filter:blur(8px) saturate(180%);box-shadow:inset 1px 1px 0 rgba(255,255,255,0.1),inset -1px -1px 0 rgba(0,0,0,0.05);
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
-webkit-touch-callout: none;
}
html[data-theme-mode="light"] .qq-login-btn,
html[data-theme-mode="light"] .user-info-display {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.9);
    color: var(--color-text-main);
    box-shadow: 
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05),
        0 2px 4px rgba(0, 0, 0, 0.02);
}
.qq-login-btn:hover, .user-info-display:hover {
    background:rgba(56,161,105,0.08);color:var(--color-green);transform:translateY(-3px) scale(1.02);border-color:rgba(56,161,105,0.2);box-shadow:0 6px 20px var(--hover-glow);
}
html[data-theme-mode="light"] .qq-login-btn:hover,
html[data-theme-mode="light"] .user-info-display:hover {
    background: rgba(45, 180, 141, 0.12);
    color: var(--color-green-deep);
    border-color: var(--color-green);
    box-shadow: 0 6px 20px rgba(45, 180, 141, 0.15);
}
.qq-login-btn:active, .user-info-display:active {transform:translateY(0) scale(var(--active-scale));}
.user-info-display {color:var(--color-green);}
.user-info-display {
  position: relative;
  cursor: pointer;
}
.user-dropdown-trigger {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 0 4px;
}
.user-dropdown-menu {
  position: absolute;
  top: calc(100% + 8px);
  left: 0;
  min-width: 100px;
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  box-shadow: var(--glass-shadow), inset 1px 1px 0 var(--glass-inset-light), inset -1px -1px 0 var(--glass-inset-dark);
  backdrop-filter: blur(12px) saturate(180%) contrast(1.1);
  -webkit-backdrop-filter: blur(12px) saturate(180%) contrast(1.1);
  padding: 10px 0;
  display: none;
  z-index: 9999;
}
.user-dropdown-menu.show {
  display: block;
  animation: dropdownFade 0.3s ease forwards;
}
@keyframes dropdownFade {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}
.dropdown-item {
  padding: 8px 18px;
  font-size: 14px;
  color: var(--color-text-main);
  text-align: center;
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}
.dropdown-item:hover {
  background: rgba(56, 161, 105, 0.15);
  color: var(--color-green);
  padding-right: 22px;
}
.user-avatar {width:24px;height:24px;border-radius:50%;object-fit:cover;border:1px solid rgba(56,161,105,0.3);}
.comment-wrap {width:100%;margin-top:20px;border-top:1px solid rgba(255,255,255,0.08);padding-top:20px;}
.comment-title {font-size:18px;font-weight:var(--font-weight-bold);color:var(--color-green);margin-bottom:15px;text-align:left;display:block !important;}
.comment-input-box {width:100%;display:flex;gap:10px;margin-bottom:20px;}
.comment-input {
    flex:1;
    min-height: 42px;
    max-height: 200px;
    background:transparent;
    border:1px solid var(--glass-border);
    border-radius:12px;
    padding: 12px 15px;
    color:var(--color-text-main);
    font-size:15px;
    outline:none;
    transition:all 0.3s ease;
    backdrop-filter:blur(10px) saturate(150%);
    -webkit-backdrop-filter:blur(10px) saturate(150%);
    box-shadow:inset 1px 1px 0 var(--glass-inset-light),inset -1px -1px 0 var(--glass-inset-dark);
    resize: none;
    overflow: hidden;
    line-height: 1.5;
}
html[data-theme-mode="light"] .comment-input {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.9);
    box-shadow: 
        inset 1px 1px 0 rgba(255, 255, 255, 0.95),
        inset -1px -1px 0 rgba(0, 0, 0, 0.05);
}
.comment-input:focus {border-color:rgba(56,161,105,0.4);box-shadow:0 0 15px var(--hover-glow);}
html[data-theme-mode="light"] .comment-input:focus {
    border-color: var(--color-green);
    box-shadow: 0 0 0 3px rgba(45, 180, 141, 0.15);
}
.comment-submit-btn {height:42px;padding:0 20px;background:transparent;border:1px solid var(--glass-border);border-radius:12px;color:var(--color-green);font-size:14px;cursor:pointer;transition:all 0.4s cubic-bezier(0.34,1.56,0.64,1);}
html[data-theme-mode="light"] .comment-submit-btn {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.9);
    color: var(--color-green);
    box-shadow: 
        0 2px 6px rgba(0, 0, 0, 0.04),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95);
}
.comment-submit-btn:hover {background:rgba(56,161,105,0.08);transform:translateY(-3px) scale(1.02);border-color:rgba(56,161,105,0.4);box-shadow:0 8px 20px var(--hover-glow);}
html[data-theme-mode="light"] .comment-submit-btn:hover {
    background: rgba(45, 180, 141, 0.12);
    color: var(--color-green-deep);
    border-color: var(--color-green);
    box-shadow: 0 8px 20px rgba(45, 180, 141, 0.15);
}
.comment-submit-btn:disabled {color:var(--color-text-sub);border-color:rgba(255,255,255,0.08);cursor:not-allowed;background:transparent;transform:none;box-shadow:none;}
.comment-list {width:100%;display:flex;flex-direction:column;gap:15px;}
.comment-item {width:100%;background:var(--glass-bg);border-radius:12px;padding:15px;border:1px solid var(--glass-border);box-shadow:var(--glass-shadow);text-align:left;}
html[data-theme-mode="light"] .comment-item {
    background: rgba(255, 255, 255, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.8);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.04),
        inset 1px 1px 0 rgba(255, 255, 255, 0.95);
}
.comment-user-info {display:flex;align-items:center;gap:8px;margin-bottom:8px;}
.comment-user-avatar {width:28px;height:28px;border-radius:50%;object-fit:cover;border:1px solid rgba(56,161,105,0.2);}
.comment-user-name {font-size:14px;font-weight:var(--font-weight-medium);color:var(--color-green);}
.comment-time {font-size:12px;color:var(--color-text-sub);margin-left:auto;}
.comment-content {font-size:15px;color:var(--color-text-main);line-height:1.7;padding-left:36px;}
.comment-empty {text-align:center;color:var(--color-text-sub);padding:20px 0;font-size:14px;}
.comment-login-tip {text-align:center;color:var(--color-green);padding:20px 0;font-size:14px;cursor:pointer;}
.comment-login-tip:hover {text-decoration:underline;}
.news-nav-btns {
    position: fixed;
    top: 50%;
    right: 50px;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 15px;
    z-index: 99999;
}

.news-nav-btn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: var(--glass-bg);
    backdrop-filter: blur(12px) saturate(180%);
    -webkit-backdrop-filter: blur(12px) saturate(180%);
    border: 1px solid var(--glass-border);
    color: var(--color-green);
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
    box-shadow: var(--glass-shadow),
                inset 1px 1px 0 var(--glass-inset-light),
                inset -1px -1px 0 var(--glass-inset-dark);
    display: flex;
    align-items: center;
    justify-content: center;
}

html[data-theme-mode="light"] .news-nav-btn {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.9);
}

.news-nav-btn:hover {
    background: var(--color-green);
    color: #fff;
    transform: scale(1.1);
    box-shadow: 0 0 20px var(--hover-glow);
}

.news-nav-btn:disabled {
    opacity: 0.2;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
    background: var(--glass-bg);
    color: var(--color-text-sub);
}

@media (max-width: 768px) {
    .news-nav-btn {
        width: 40px;
        height: 40px;
        font-size: 16px;
    }
    .news-nav-btns {
        right: 15px;
        gap: 10px;
    }
}
@keyframes apple-breathe {
  0%, 100% { opacity: 0.4; transform: scale(0.9); }
  50% { opacity: 1; transform: scale(1.1); }
}
.apple-loading-comment {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  font-weight: 300;
  letter-spacing: 0.5px;
  transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
}
.apple-loading-dot {
  width: 4px;
  height: 4px;
  border-radius: 50%;
  background: rgba(56, 161, 105, 0.8);
  display: inline-block;
  margin: 0 1px;
}
    </style>
</head>
<body>
    <div id="loader">
        <div class="loading-left-bg loading-bg"></div>
        <div class="loading-right-bg loading-bg"></div>
        <div class="spinner-box">
            <div class="loading-taichi rotate">
                <svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" xmlns="https://www.w3.org/2000/svg">
                    <path d="M303.5 432A80 80 0 0 1 291.5 592A80 80 0 0 1 303.5 432z" />
                    <path d="M512 65A447 447 0 0 1 512 959L512 929A417 417 0 0 0 512 95A417 417 0 0 0 512 929L512 959A447 447 0 0 1 512 65z M512 95A417 417 0 0 1 929 512A208.5 208.5 0 0 1 720.5 720.5L720.5 592A80 80 0 0 0 720.5 432A80 80 0 0 0 720.5 592L720.5 720.5A208.5 208.5 0 0 1 512 512A208.5 208.5 0 0 0 303.5 303.5A208.5 208.5 0 0 0 95 512A417 417 0 0 1 512 95z" />
                </svg>
            </div>
            <div class="loading-word">æ˜¥å¤©æ˜¯å¥¹æœ€çˆ±çš„å­£èŠ‚...</div>
        </div>
    </div>

    <div class="container">
        <nav id="header-nav">
            <div class="theme-bg-switch-group">
                <label class="theme-switch-wrap">
                    <label class="theme-switch">
                        <input type="checkbox" id="themeToggle">
                        <span class="theme-slider"></span>
                    </label>
                </label>
                <div class="bg-switch-wrap">
                    <button class="bg-switch-btn" id="bgChangeBtn">
                        <i class="iconfont icon-refresh"></i>
                        åˆ‡æ¢èƒŒæ™¯
                    </button>
                </div>
            </div>
            <div class="nav-center">
                <span class="main-nav-link-wrap"><a class="main-nav-link active" href="index.html">é¦–é¡µ</a></span>
                <span class="main-nav-link-wrap"><a class="main-nav-link" href="moguone/tool.html">Toolå·¥å…·</a></span>
            </div>
            <div class="nav-right" id="userLoginArea">
                <a href="moguone/login.html" class="github-login-btn" id="loginBtn">
                    <i class="iconfont icon-user"></i> ç™»å½•
                </a>
                <div class="user-info-display" id="userInfoBox" style="display: none;">
                  <div class="user-dropdown-trigger">
                    <span id="userNickName">æ˜µç§°</span>
                  </div>
                  <div class="user-dropdown-menu">
                    <div class="dropdown-item" id="userSettingBtn">ä¸ªäººä¸­å¿ƒ</div>
                    <div class="dropdown-item" id="logoutBtn">é€€å‡ºç™»å½•</div>
                  </div>
                </div>
            </div>
        </nav>
        <div class="container-main">
            <aside id="sidebar">
                <div class="sidebar-wrap" data-aos="fade-up">
                    <div class="sidebar-author">
                        <img src="https://img.wjwj.top/2026/01/16/a27c17b713d7998cebb06b1dde372d64.jpg" alt="ä¸ªäººå¤´åƒ">
                        <div class="sidebar-author-name">Mo GuOne</div>
                        <div class="sidebar-description">çƒ­çˆ±æ˜¯æ‰€æœ‰çš„ç†ç”±å’Œç­”æ¡ˆ</div>
                    </div>
                    <div class="sidebar-social">
                        <a href="https://github.com/migolqn/moguwan" title="Github" target="_blank"><i class='social iconfont icon-github'></i></a>
                        <a href="https://www.zhihu.com/" title="çŸ¥ä¹Ž" target="_blank"><i class='social iconfont icon-zhihu'></i></a>
                        <a href="mailto:2926197119@qq.com" title="é‚®ç®±"><i class='social iconfont icon-email'></i></a>
                    </div>
                    <div class="sidebar-menu">
                        <div class="sidebar-stat-wrap">
                            <div class="stat-item">
                                <div class="stat-num" id="totalCount">0</div>
                                <div class="stat-text">æ€»è®¿é—®é‡</div>
                            </div>
                        </div>
                        <div class="sidebar-update-log"><div class="update-log-title">ðŸ“Œ ç‰ˆæœ¬æ›´æ–°æ—¥å¿—</div></div>
                    </div>
                </div>
            </aside>
        
            <div id="content">
                <section id="main">
                    <article class="article-inner" data-aos="fade-up">
                        <h1 class="article-title" data-aos="slide-up">MY HOME</h1>
                        <p class="article-signature" data-aos="slide-up">
                            ä½ ä¼šä¸ä¼šå¿½ç„¶çš„å‡ºçŽ°ï¼Œåœ¨è¡—è§’çš„å’–å•¡åº—ã€‚<strong>â€”é™ˆå¥•è¿… ã€Šå¥½ä¹…ä¸è§ã€‹</strong><br> 
                            <p class="article-signature" data-aos="slide-up">
                                ç‚¹å‡»ä¸‹æ–¹çš„å¤§æ ‡é¢˜å¯ä»¥æ‰“å¼€è¯¦æƒ…é¡µä»¥åŠæŸ¥çœ‹å‘è¡¨è¯„è®º,è¯„è®ºåŠ è½½æœ‰ç‚¹æ…¢ è¯·è€å¿ƒç­‰å¾…ðŸ˜„<br>
                            </p>
                        </p>
                        <div class="search-box-container">
                            <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢æ—¥è®°æ ‡é¢˜/å†…å®¹å…³é”®è¯...">
                            <button class="search-btn" id="searchBtn"><i class="iconfont icon-search"></i> æœç´¢</button>
                            <button class="search-btn" id="resetBtn"><i class="iconfont icon-close"></i> é‡ç½®</button>
                        </div>
                    </article>
                    <div class="news-container" id="newsScroll"></div>
                </section>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div class="music-player">
        <div class="music-btn play-icon" id="playBtn"></div>
        <div class="music-text">Top Barry - ä¸€åŠä¸€åŠ</div>
        <audio id="music" loop preload="auto">
            <source src="moguone/song/ä¸€åŠä¸€åŠ.mp3" type="audio/mpeg">
        </audio>
    </div>
</footer>
    <div class="sidebar-top" id="sidebarTop">
        <div class="arrow-up">â†‘</div>
    </div>
    
    <div class="tip-modal-mask" id="tipModalMask">
        <div class="tip-modal-box glass-effect">
            <button class="tip-modal-close-btn" id="tipModalCloseBtn">âœ•</button>
            <div class="tip-modal-icon">!</div>
            <div class="tip-modal-text">è¯·è¾“å…¥æœç´¢å…³é”®è¯</div>
        </div>
    </div>
    <div class="toast-notification" id="toastNotification">
        <span class="icon loading-spinner" style="display: none;"></span>
        <span class="icon success-icon">âœ“</span>
        <span class="text">æ“ä½œæˆåŠŸï¼</span>
    </div>
    
    <div class="img-preview-mask" id="imgPreviewMask">
        <button class="preview-close-btn" id="previewCloseBtn">âœ•</button>
        <button class="preview-nav-btn preview-prev-btn" id="previewPrevBtn">â—€</button>
        <button class="preview-nav-btn preview-next-btn" id="previewNextBtn">â–¶</button>
        <div class="preview-pagination" id="previewPagination">1/1</div>
        <img src="" alt="é¢„è§ˆå›¾ç‰‡" class="preview-img" id="previewImg">
        <video class="preview-video" id="previewVideo" controls playsinline webkit-playsinline x5-playsinline preload="auto"></video>
    </div>
    <div class="tip-modal-mask" id="bgModalMask">
        <button class="tip-modal-close-btn" id="bgModalCloseBtn">âœ•</button>
        <div class="tip-modal-box glass-effect">
            <div style="font-size:18px; font-weight:bold; color:var(--color-green); margin-bottom:10px;">å£çº¸é€‰æ‹©ä¸­å¿ƒ âœ¨</div>
            <div class="bg-tab-group">
                <button class="bg-tab-btn active" id="customBgTab">æˆ‘çš„å£çº¸ (è‡ªå®šä¹‰)</button>
                <button class="bg-tab-btn" id="officialBgTab">å®˜æ–¹å£çº¸</button>
            </div>
            <div style="display:flex;gap:10px;margin-bottom:10px;flex-wrap: wrap;">
                <button class="search-btn" id="addBgBtn" style="padding:0 20px;">+ è‡ªå®šä¹‰æ·»åŠ å£çº¸</button>
                <input type="file" id="bgFileInput" accept="image/jpg,image/png,image/webp" style="display:none;">
                <span style="font-size:12px;color:var(--color-text-sub);margin:auto 0;">æ”¯æŒJPG/PNG/WEBPï¼Œå›¾ç‰‡è‡ªåŠ¨æ°¸ä¹…ä¿å­˜</span>
            </div>
            <div id="bgThumbList"></div>
        </div>
    </div>
    <div class="news-modal-mask" id="newsModalMask">
        <div class="news-nav-btns">
            <button class="news-nav-btn news-next-btn" id="newsNextBtn">â†‘</button>
            <button class="news-nav-btn news-prev-btn" id="newsPrevBtn">â†“</button>
        </div>
        <div class="news-modal-box">
            <button class="modal-close-btn" id="modalCloseBtn">âœ•</button>
            <div class="modal-news-content" id="modalNewsContent"></div>
            <div class="modal-comment-area" id="modalCommentArea"></div>
        </div>
    </div>

    <script type="text/javascript">
const GITHUB_TOKEN = ["g","h","p_Eulq5","0oi65","MM7A", "rEk8H7yz","9k5W9l9", "O0e6Xmh"].join('');
const COUNT_ISSUE_NUMBER = 7;
const NEWS_ISSUE_NUMBER = 322;
const NEWS_SEPARATOR = '---';
const COUNT_REG = /æ€»è®¿é—®é‡ï¼š(\d+)/;
const NEWS_VIEW_PREFIX = "æµè§ˆ";
const NEWS_VIEW_SUFFIX = "é‡ï¼š";
const NEWS_VIEW_REG = /æµè§ˆ(\d+)é‡ï¼š(\d+)/g;
const NEWS_LIKE_PREFIX = "ç‚¹èµž";
const NEWS_LIKE_SUFFIX = "æ•°é‡ï¼š";
const NEWS_LIKE_REG = /ç‚¹èµž(\d+)æ•°é‡ï¼š(\d+)/g;
let newsLikeCounts = {};
const COMMENT_MAP_ISSUE_NUMBER = 299;
const DEFAULT_AVATAR = "https://img.wjwj.top/2026/01/20/d6346e9c8e93165079c5ab74f856358c.png";
const USER_LOCAL_KEY = 'MY_CUSTOM_USER_INFO';
let currentUser = null;
let bgUrlList = [];
let customBgList = [];
let allBgList = [];
const BG_CUSTOM_KEY = 'custom_bg_list';
const BG_INDEX_KEY = 'saveBgIndex';
let currentBgTab = 'custom';
let isAnimating = false;
let imgObserver = null;
let videoObserver = null;
let newsDataList = [];
let currentModalIndex = -1;
let scrollTopVal = 0;
let newsAnimateObserver = null;
const GITHUB_REPO = "moguwan/moguwan.github.io";
let isLogin = false;
let userInfo = {
    avatar: '',
    nickname: '',
    openid: ''
};
function initLoginState() {
    const saveUser = localStorage.getItem(USER_LOCAL_KEY);
    if (saveUser) {
        try {
            currentUser = JSON.parse(saveUser);
            userInfo = {
                avatar: currentUser.avatar || DEFAULT_AVATAR,
                nickname: currentUser.nickname || "æœªçŸ¥ç”¨æˆ·",
                openid: currentUser.openid || currentUser.account || ""
            };
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('userInfoBox').style.display = 'flex';
            document.getElementById('userNickName').textContent = userInfo.nickname;
            const dropdownMenu = document.querySelector('.user-dropdown-menu');
            dropdownMenu.innerHTML = '';
            const settingItem = document.createElement('div');
            settingItem.className = 'dropdown-item';
            settingItem.id = 'userSettingBtn';
            settingItem.textContent = 'ä¸ªäººä¸­å¿ƒ';
            dropdownMenu.appendChild(settingItem);
            if (currentUser.isAdmin) {
                const adminItem = document.createElement('div');
                adminItem.className = 'dropdown-item';
                adminItem.id = 'adminManageBtn';
                adminItem.textContent = 'åŽå°ç®¡ç†';
                dropdownMenu.appendChild(adminItem);
            }
            const logoutItem = document.createElement('div');
            logoutItem.className = 'dropdown-item';
            logoutItem.id = 'logoutBtn';
            logoutItem.textContent = 'é€€å‡ºç™»å½•';
            dropdownMenu.appendChild(logoutItem);
            isLogin = true;
        } catch (e) {
            console.error("ç™»å½•çŠ¶æ€è§£æžå¤±è´¥ï¼š", e);
            isLogin = false;
            userInfo = { avatar: '', nickname: '', openid: '' };
        }
    } else {
        currentUser = null;
        userInfo = { avatar: '', nickname: '', openid: '' };
        isLogin = false;
    }
    document.getElementById('userSettingBtn')?.addEventListener('click', () => {
        window.location.href = 'moguone/setting.html';
    });
    document.getElementById('adminManageBtn')?.addEventListener('click', () => {
        window.location.href = 'moguone/admin.html';
    });
    document.getElementById('logoutBtn')?.addEventListener('click', logout);
}
async function getAllUsers() {
    const requestHeaders = {
        "Authorization": `token ${GITHUB_TOKEN}`,
        "Accept": "application/vnd.github.v3+json",
        "User-Agent": "Mozilla/5.0"
    };
    try {
        const res = await fetch(
            `https://api.github.com/repos/${GITHUB_REPO}/issues/${USER_ISSUE_NUMBER}`,
            { headers: requestHeaders, method: "GET" }
        );
        if (!res.ok) {
            return [];
        }
        const issue = await res.json();
        const userLines = issue.body.split('\n').filter(line => line.includes('|'));
        const users = [];
        userLines.forEach(line => {
            const parts = line.split('|');
            const account = parts[0]?.trim() || '';
            const pwd = parts[1]?.trim() || '';
            const email = parts[2]?.trim() || '';
            const nickname = parts[3]?.trim() || account;
            const isAdmin = parts[4]?.trim() === 'ç®¡ç†å‘˜';
            if (account && pwd) {
                users.push({
                    account: account,
                    password: pwd,
                    email: email,
                    nickname: nickname,
                    isAdmin: isAdmin
                });
            }
        });
        return users;
    } catch (err) {
        console.log('è¯»å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼š', err);
        const localUsers = localStorage.getItem('temp_users');
        return localUsers ? JSON.parse(localUsers) : [];
    }
}
async function saveUserToIssue(newUser) {
    const requestHeaders = {
        "Authorization": `token ${GITHUB_TOKEN}`,
        "Accept": "application/vnd.github.v3+json",
        "User-Agent": "Mozilla/5.0"
    };
    try {
        const users = await getAllUsers();
        users.push(newUser);
        let body = "ç½‘ç«™ç”¨æˆ·ä¿¡æ¯åˆ—è¡¨ï¼ˆè¯·å‹¿æ‰‹åŠ¨ä¿®æ”¹ï¼‰\n";
        users.forEach(user => {
            body += `${user.account}|${user.password}|${user.email}|${user.nickname}\n`;
        });
        const res = await fetch(
            `https://api.github.com/repos/${GITHUB_REPO}/issues/${USER_ISSUE_NUMBER}`,
            {
                headers: requestHeaders,
                method: "PATCH",
                body: JSON.stringify({ 
                    title: "ç½‘ç«™ç”¨æˆ·ä¿¡æ¯å­˜å‚¨",
                    body: body.trim()
                })
            }
        );
        if (res.ok) {
            localStorage.setItem('temp_users', JSON.stringify(users));
            return true;
        } else {
            return false;
        }
    } catch (err) {
        console.log('ä¿å­˜ç”¨æˆ·å¤±è´¥ï¼š', err);
        return false;
    }
}
function logout() {
    currentUser = null;
    isLogin = false;
    localStorage.removeItem(USER_LOCAL_KEY);
    document.getElementById('userInfoBox').style.display = 'none';
    document.getElementById('loginBtn').style.display = 'flex';
    const toast = document.getElementById('toastNotification');
    toast.querySelector('.text').textContent = 'é€€å‡ºç™»å½•æˆåŠŸï¼';
    toast.classList.add('show');
    setTimeout(() => {
        toast.classList.remove('show');
    }, 2000);
}
async function getCommentData(newsIndex) {
    const requestHeaders = {
        "Authorization": `token ${GITHUB_TOKEN}`,
        "Accept": "application/vnd.github.v3+json",
        "User-Agent": "Mozilla/5.0"
    };
    
    try {
        const commentIssueNumber = await getCommentIssueNumber(newsIndex);
        const res = await fetch(
            `https://api.github.com/repos/${GITHUB_REPO}/issues/${commentIssueNumber}/comments`,
            { headers: requestHeaders, method: "GET" }
        );
        
        if (!res.ok) {
            console.error("èŽ·å–GitHubè¯„è®ºå¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š", res.status);
            return [];
        }
        
        const githubComments = await res.json();
        const githubMainComments = [];
        
        // ä»…è§£æžä¸»è¯„è®ºï¼Œå¿½ç•¥å›žå¤
        githubComments.forEach(comment => {
            const parts = comment.body.split('|');
            let openid = parts[0] || "unknown";
            let nickname = parts[1] || "åŒ¿åç”¨æˆ·";
            let content = parts[2] || comment.body;
            
            // è¿‡æ»¤å›žå¤ç±»åž‹çš„è¯„è®º
            if (parts.length >= 5 && parts[3] === 'reply') {
                return; // è·³è¿‡å›žå¤
            }
            
            if (content.startsWith('ã€') && content.endsWith('ã€‘')) {
                content = content.slice(1, -1);
            }
            
            githubMainComments.push({
                id: comment.id, // æ–°å¢žï¼šä¿å­˜GitHubè¯„è®ºçš„å”¯ä¸€IDï¼ˆåˆ é™¤éœ€è¦ç”¨åˆ°ï¼‰
                avatar: DEFAULT_AVATAR,
                nickname: nickname,
                content: content,
                time: new Date(comment.created_at).getTime(),
                openid: openid
            });
        });
        
        // ç›´æŽ¥è¿”å›žGitHubçš„è¯„è®ºï¼ŒæŒ‰æ—¶é—´å€’åºæŽ’åº
        return githubMainComments.sort((a, b) => b.time - a.time);
    } catch (err) {
        console.error("èŽ·å–è¯„è®ºæ•°æ®å‡ºé”™ï¼š", err);
        return [];
    }
}
async function getCommentIssueNumber(newsIndex) {
    const requestHeaders = {
        "Authorization": `token ${GITHUB_TOKEN}`,
        "Accept": "application/vnd.github.v3+json",
        "User-Agent": "Mozilla/5.0"
    };
    try {
        const mapRes = await fetch(
            `https://api.github.com/repos/${GITHUB_REPO}/issues/${COMMENT_MAP_ISSUE_NUMBER}`,
            { headers: requestHeaders, method: "GET" }
        );
        if (!mapRes.ok) throw new Error(`è¯·å…ˆæ‰‹åŠ¨åˆ›å»ºã€Œè¯„è®ºæ˜ å°„Issueã€ï¼ˆç¼–å·${COMMENT_MAP_ISSUE_NUMBER}ï¼‰`);
        const mapIssue = await mapRes.json();
        const mapBody = mapIssue.body || '';
        const issueMap = {};
        mapBody.split('\n').forEach(line => {
            const match = line.match(/^news_(\d+): (\d+)$/);
            if (match) issueMap[parseInt(match[1])] = parseInt(match[2]);
        });
        if (issueMap[newsIndex] !== undefined) return issueMap[newsIndex];
        const newIssueRes = await fetch(
            `https://api.github.com/repos/${GITHUB_REPO}/issues`,
            {
                headers: requestHeaders,
                method: "POST",
                body: JSON.stringify({
                    title: `comment_#${newsIndex}`,
                    body: `è¯¥Issueç”¨äºŽå­˜å‚¨æ—¥è®°IDä¸º ${newsIndex} çš„è¯„è®ºå†…å®¹ï¼Œæ ¼å¼ï¼šè´¦å·|ç”¨æˆ·å|ã€è¯„è®ºå†…å®¹ã€‘`,
                    labels: ["comment", `news-${newsIndex}`]
                })
            }
        );
        if (!newIssueRes.ok) {
            const errText = await newIssueRes.text();
            throw new Error(`åˆ›å»ºè¯„è®ºIssueå¤±è´¥ï¼š${newIssueRes.status} - ${errText}`);
        }
        const newIssue = await newIssueRes.json();
        const newIssueNumber = newIssue.number;
        const newMapBody = `${mapBody}\nnews_${newsIndex}: ${newIssueNumber}`.trim();
        await fetch(
            `https://api.github.com/repos/${GITHUB_REPO}/issues/${COMMENT_MAP_ISSUE_NUMBER}`,
            {
                headers: requestHeaders,
                method: "PATCH",
                body: JSON.stringify({ body: newMapBody })
            }
        );
        return newIssueNumber;
    } catch (err) {
        console.log('èŽ·å–è¯„è®ºIssueç¼–å·å¤±è´¥ï¼š', err);
        throw err;
    }
}
async function saveCommentData(newsIndex, comment) {
    try {
        // ç§»é™¤æ‰€æœ‰æœ¬åœ°ç¼“å­˜ç›¸å…³ä»£ç 
        // ç›´æŽ¥æäº¤åˆ°GitHub
        const commentIssueNumber = await getCommentIssueNumber(newsIndex);
        const requestHeaders = {
            "Authorization": `token ${GITHUB_TOKEN}`,
            "Accept": "application/vnd.github.v3+json",
            "User-Agent": "Mozilla/5.0"
        };
        const commentBody = `${comment.openid}|${comment.nickname}|ã€${comment.content}ã€‘`;
        
        const res = await fetch(
            `https://api.github.com/repos/${GITHUB_REPO}/issues/${commentIssueNumber}/comments`,
            {
                headers: requestHeaders,
                method: "POST",
                body: JSON.stringify({ body: commentBody })
            }
        );
        
        if (!res.ok) {
            const errText = await res.text();
            console.error("æäº¤è¯„è®ºåˆ°GitHubå¤±è´¥ï¼š", res.status, errText);
            return false; // æäº¤å¤±è´¥è¿”å›žfalse
        }
        return true; // æäº¤æˆåŠŸè¿”å›žtrue
    } catch (err) {
        console.error('ä¿å­˜è¯„è®ºå‡ºé”™ï¼š', err);
        return false; // å¼‚å¸¸æ—¶è¿”å›žfalse
    }
}
function formatTime(timestamp) {
    const date = new Date(timestamp);
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const hour = date.getHours().toString().padStart(2, '0');
    const minute = date.getMinutes().toString().padStart(2, '0');
    return `${year}-${month}-${day} ${hour}:${minute}`;
}
function renderCommentArea(newsIndex) {
    const commentArea = document.getElementById('modalCommentArea');
    commentArea.innerHTML = '';
    const commentWrap = document.createElement('div');
    commentWrap.className = 'comment-wrap';
    const commentTitle = document.createElement('div');
    commentTitle.className = 'comment-title';
    commentTitle.textContent = 'ðŸ’¬ comment';
    commentWrap.appendChild(commentTitle);
    
    // æœªç™»å½•æç¤º
    if (!isLogin) {
        const loginTip = document.createElement('div');
        loginTip.className = 'comment-login-tip';
        loginTip.textContent = 'ä½ è¿˜æœªç™»å½•ï¼Œç‚¹å‡»æ­¤å¤„ç™»å½• â†’ ç™»å½•åŽå³å¯å‘è¡¨è¯„è®º';
        loginTip.onclick = openLoginModal;
        commentWrap.appendChild(loginTip);
        commentArea.appendChild(commentWrap);
        return;
    }

    // è¯„è®ºè¾“å…¥æ¡†ï¼ˆä»…ä¿ç•™å‘è¡¨è¯„è®ºï¼‰
    const inputBox = document.createElement('div');
    inputBox.className = 'comment-input-box';
    const commentInput = document.createElement('textarea');
    commentInput.className = 'comment-input';
    commentInput.placeholder = 'å†™ä¸‹ä½ çš„è¯„è®ºå§...';
    commentInput.rows = 1;
    const submitBtn = document.createElement('button');
    submitBtn.className = 'comment-submit-btn';
    submitBtn.textContent = 'å‘è¡¨è¯„è®º';
    submitBtn.disabled = true;
    inputBox.appendChild(commentInput);
    inputBox.appendChild(submitBtn);
    commentWrap.appendChild(inputBox);

    // è¾“å…¥æ¡†è‡ªé€‚åº”é«˜åº¦
    commentInput.addEventListener('focus', () => {
        commentInput.style.height = 'auto';
        commentInput.style.height = commentInput.scrollHeight + 'px';
    });
    commentInput.addEventListener('input', () => {
        const content = commentInput.value.trim();
        submitBtn.disabled = content.length === 0 || !isLogin;
        commentInput.style.height = 'auto';
        const contentHeight = commentInput.scrollHeight;
        const maxHeight = parseInt(getComputedStyle(commentInput).maxHeight);
        commentInput.style.height = Math.min(contentHeight, maxHeight) + 'px';
    });
    commentInput.dispatchEvent(new Event('input'));

    // å‘è¡¨è¯„è®ºæŒ‰é’®äº‹ä»¶
    submitBtn.addEventListener('click', async () => {
        const content = commentInput.value.trim();
        if (!content || !isLogin) {
            alert(isLogin ? "è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©ºï¼" : "è¯·å…ˆç™»å½•åŽå‘è¡¨è¯„è®ºï¼");
            return;
        }
        submitBtn.disabled = true;
        submitBtn.textContent = 'æäº¤ä¸­...';
        
        // æž„é€ è¯„è®ºæ•°æ®
        const newComment = {
            avatar: userInfo.avatar || DEFAULT_AVATAR,
            nickname: userInfo.nickname || "æœªçŸ¥ç”¨æˆ·",
            content: content,
            time: Date.now(),
            openid: userInfo.openid || "unknown"
        };
        
        // ä¿å­˜è¯„è®ºï¼ˆä»…æäº¤åˆ°GitHubï¼‰
        const saveResult = await saveCommentData(newsIndex, newComment);
        if (saveResult) {
            // æ¸…ç©ºè¾“å…¥æ¡†
            commentInput.value = '';
            commentInput.style.height = 'auto';
            commentInput.style.height = commentInput.scrollHeight + 'px';
            
            // æç¤ºæˆåŠŸ
            const toast = document.getElementById('toastNotification');
            toast.querySelector('.text').textContent = 'è¯„è®ºå‘è¡¨æˆåŠŸï¼';
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
            
            // å…³é”®ä¿®æ”¹ï¼šé‡æ–°ä»ŽGitHubèŽ·å–æœ€æ–°è¯„è®ºåˆ—è¡¨
            commentList.innerHTML = `
              <div class="comment-empty apple-loading-comment" style="text-align:center; padding:20px; color:var(--color-green); font-weight:300; letter-spacing:0.5px; font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                <span style="display:inline-flex; align-items:center; gap:8px;">
                  åˆ·æ–°è¯„è®ºä¸­
                  <span style="display:flex; gap:2px; margin-top:2px;">
                    <span style="width:4px; height:4px; border-radius:50%; background:var(--color-green); animation: apple-breathe 1.2s infinite ease-in-out 0s;"></span>
                    <span style="width:4px; height:4px; border-radius:50%; background:var(--color-green); animation: apple-breathe 1.2s infinite ease-in-out 0.2s;"></span>
                    <span style="width:4px; height:4px; border-radius:50%; background:var(--color-green); animation: apple-breathe 1.2s infinite ease-in-out 0.4s;"></span>
                  </span>
                </span>
              </div>
            `;
            
            // ä»ŽGitHubé‡æ–°åŠ è½½è¯„è®º
            getCommentData(newsIndex).then(comments => {
                commentList.innerHTML = '';
                const sortedComments = [...comments].sort((a, b) => b.time - a.time);
                
                // æ— è¯„è®ºæç¤º
                if (sortedComments.length === 0) {
                    const emptyTip = document.createElement('div');
                    emptyTip.className = 'comment-empty';
                    emptyTip.textContent = 'æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§ï½ž';
                    commentList.appendChild(emptyTip);
                } else {
                    // é‡æ–°æ¸²æŸ“æ‰€æœ‰è¯„è®ºï¼ˆåŒ…å«åˆ é™¤æŒ‰é’®é€»è¾‘ï¼‰
                    sortedComments.forEach(comment => {
                        // è¿™é‡Œå¤åˆ¶ç¬¬ä¸‰æ­¥ä¸­æ¸²æŸ“å•æ¡è¯„è®ºçš„ä»£ç å³å¯
                        const commentItem = document.createElement('div');
                        commentItem.className = 'comment-item';
                        commentItem.dataset.commentId = comment.id;
                        
                        const commentHeader = document.createElement('div');
                        commentHeader.className = 'comment-user-info';
                        
                        let headerHtml = `
                            <img src="${comment.avatar || DEFAULT_AVATAR}" alt="å¤´åƒ" class="comment-user-avatar">
                            <span class="comment-user-name">${comment.nickname}</span>
                            <span class="comment-time">${formatTime(comment.time)}</span>
                        `;
                    });
                }
            });
        } else {
            alert("è¯„è®ºå‘è¡¨å¤±è´¥ï¼Œè¯·é‡è¯•ï¼");
        }
        submitBtn.textContent = 'å‘è¡¨è¯„è®º';
        submitBtn.disabled = false;
    });

    // è¯„è®ºåˆ—è¡¨å®¹å™¨
    const commentList = document.createElement('div');
    commentList.className = 'comment-list';
    commentList.innerHTML = `
      <div class="comment-empty apple-loading-comment" style="text-align:center; padding:20px; color:var(--color-green); font-weight:300; letter-spacing:0.5px; font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
        <span style="display:inline-flex; align-items:center; gap:8px;">
          åŠ è½½è¯„è®ºä¸­
          <span style="display:flex; gap:2px; margin-top:2px;">
            <span style="width:4px; height:4px; border-radius:50%; background:var(--color-green); animation: apple-breathe 1.2s infinite ease-in-out 0s;"></span>
            <span style="width:4px; height:4px; border-radius:50%; background:var(--color-green); animation: apple-breathe 1.2s infinite ease-in-out 0.2s;"></span>
            <span style="width:4px; height:4px; border-radius:50%; background:var(--color-green); animation: apple-breathe 1.2s infinite ease-in-out 0.4s;"></span>
          </span>
        </span>
      </div>
    `;
    const style = document.createElement('style');
    style.textContent = `
      @keyframes apple-breathe {
        0%, 100% { opacity: 0.4; transform: scale(0.9); }
        50% { opacity: 1; transform: scale(1.1); }
      }
    `;
    commentList.appendChild(style);
    commentWrap.appendChild(commentList);

    // åŠ è½½è¯„è®ºæ•°æ®
    getCommentData(newsIndex).then(comments => {
        commentList.innerHTML = '';
        const sortedComments = [...comments].sort((a, b) => b.time - a.time);
        
        // æ— è¯„è®ºæç¤º
        if (sortedComments.length === 0) {
            const emptyTip = document.createElement('div');
            emptyTip.className = 'comment-empty';
            emptyTip.textContent = 'æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘å§ï½ž';
            commentList.appendChild(emptyTip);
        } else {
            // æ¸²æŸ“è¯„è®ºåˆ—è¡¨ï¼ˆä»…ä¸»è¯„è®ºï¼Œæ— å›žå¤/åˆ é™¤ï¼‰
            sortedComments.forEach(comment => {
                const commentItem = document.createElement('div');
                commentItem.className = 'comment-item';
                
                // è¯„è®ºå¤´éƒ¨ï¼ˆå¤´åƒ/æ˜µç§°/æ—¶é—´ï¼Œç§»é™¤å›žå¤/åˆ é™¤æŒ‰é’®ï¼‰
                const commentHeader = document.createElement('div');
                commentHeader.className = 'comment-user-info';
                commentHeader.innerHTML = `
                    <img src="${comment.avatar || DEFAULT_AVATAR}" alt="å¤´åƒ" class="comment-user-avatar">
                    <span class="comment-user-name">${comment.nickname}</span>
                    <span class="comment-time">${formatTime(comment.time)}</span>
                `;
                
                // è¯„è®ºå†…å®¹
                const commentContent = document.createElement('div');
                commentContent.className = 'comment-content';
                commentContent.textContent = comment.content;
                
                // ç»„è£…è¯„è®ºé¡¹
                commentItem.appendChild(commentHeader);
                commentItem.appendChild(commentContent);
                commentList.appendChild(commentItem);
            });
        }
    });

    commentArea.appendChild(commentWrap);
}
function openLoginModal() {
    window.location.href = 'moguone/login.html';
}
function createCommentArea(newsItem, index) {}
initLoginState();
function md5(str) {
    let hash = 0;
    if (str.length === 0) return hash.toString();
    for (let i = 0; i < str.length; i++) {
        const char = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
    }
    return hash.toString(16);
}
function initNewsLikeCounts() {
    const localData = JSON.parse(localStorage.getItem('temp_count_all')) || { total: 0, likes: {} };
    newsLikeCounts = localData.likes || {};
    if (newsDataList.length > 0) {
        newsDataList.forEach((_, index) => {
            if (typeof newsLikeCounts[index] === 'undefined') {
                newsLikeCounts[index] = 0;
            }
        });
    }
    renderNewsLikeCounts();
}
const LIKED_NEWS_KEY = 'liked_news_ids';
function initCustomBg() {
    try {
        const saveCustomBg = localStorage.getItem(BG_CUSTOM_KEY);
        customBgList = saveCustomBg ? JSON.parse(saveCustomBg) : [];
        allBgList = [...bgUrlList, ...customBgList];
    } catch (e) {
        console.log('è¯»å–è‡ªå®šä¹‰å£çº¸ç¼“å­˜å®¹é”™', e);
        customBgList = [];
        allBgList = [...bgUrlList];
        localStorage.setItem(BG_CUSTOM_KEY, JSON.stringify([]));
    }
}
function renderBgThumbnails(renderList) {
    const bgThumbList = document.getElementById('bgThumbList');
    bgThumbList.innerHTML = '';
    const saveBgIndex = Number(localStorage.getItem(BG_INDEX_KEY)) || 0;
    renderList.forEach((bgUrl, showIndex) => {
        let realIndex = 0;
        if(currentBgTab === 'custom'){
            realIndex = bgUrlList.length + showIndex;
        }else{
            realIndex = showIndex;
        }
        const isBuiltIn = currentBgTab === 'official';
        const item = document.createElement('div');
        item.className = `bg-thumb-item ${realIndex == saveBgIndex ? 'active' : ''}`;
        item.innerHTML = `
            <img src="${bgUrl}" alt="å£çº¸${showIndex+1}" style="width:100%;height:100%;object-fit:cover;">
            ${!isBuiltIn ? '<div class="bg-thumb-del" data-index="'+showIndex+'">âœ•</div>' : ''}
        `;
        item.addEventListener('click', () => {
            applyBg(bgUrl, realIndex);
            document.querySelectorAll('.bg-thumb-item').forEach(el => el.classList.remove('active'));
            item.classList.add('active');
        });
        bgThumbList.appendChild(item);
    });
    document.querySelectorAll('.bg-thumb-del').forEach(delBtn => {
        delBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            const delIndex = parseInt(delBtn.dataset.index);
            if(delIndex >=0 && delIndex < customBgList.length){
                customBgList.splice(delIndex, 1);
                localStorage.setItem(BG_CUSTOM_KEY, JSON.stringify(customBgList));
                allBgList = [...bgUrlList, ...customBgList];
                renderBgThumbnails(customBgList);
            }
        });
    });
    bgThumbList.scrollTop = 0;
}
function applyBg(bgUrl, index) {
    document.body.style.background = `url(${bgUrl}) no-repeat fixed center center`;
    document.body.style.backgroundSize = "cover";
    document.body.style.backgroundAttachment = "fixed";
    document.body.style.backgroundPosition = "center center";
    document.body.style.transition = "background 1.5s ease-in-out";
    localStorage.setItem(BG_INDEX_KEY, index);
    allBgList = [...bgUrlList, ...customBgList];
}
function openBgModal() {
    document.getElementById('bgModalMask').classList.add('show');
    document.body.style.overflow = 'hidden';
    currentBgTab = 'custom';
    document.getElementById('customBgTab').classList.add('active');
    document.getElementById('officialBgTab').classList.remove('active');
    renderBgThumbnails(customBgList);
    document.querySelector('#bgThumbList').scrollTop = 0;
    setTimeout(()=>{
        const saveBgIndex = Number(localStorage.getItem(BG_INDEX_KEY)) || 0;
        document.querySelectorAll('.bg-thumb-item').forEach((el,index) => {
            let realIndex = currentBgTab === 'custom' ? (bgUrlList.length + index) : index;
            if(realIndex === saveBgIndex) {
                el.classList.add('active');
            } else {
                el.classList.remove('active');
            }
        });
    },100);
}
function closeBgModal() {
    document.getElementById('bgModalMask').classList.remove('show');
    document.body.style.overflow = 'auto';
}
function initAddBgFunc() {
    const addBgBtn = document.getElementById('addBgBtn');
    const bgFileInput = document.getElementById('bgFileInput');
    addBgBtn.addEventListener('click', () => bgFileInput.click());
    bgFileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if(!file) return;
        if(!file.type.includes('image')){
            alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶ï¼æ”¯æŒJPG/PNG/WEBP');
            bgFileInput.value = '';
            return;
        }
        const reader = new FileReader();
        reader.onload = (e) => {
            const base64Url = e.target.result;
            customBgList.push(base64Url);
            localStorage.setItem(BG_CUSTOM_KEY, JSON.stringify(customBgList));
            allBgList = [...bgUrlList, ...customBgList];
            currentBgTab = 'custom';
            document.getElementById('customBgTab').classList.add('active');
            document.getElementById('officialBgTab').classList.remove('active');
            renderBgThumbnails(customBgList);
            const bgThumbList = document.getElementById('bgThumbList');
            bgThumbList.scrollTop = bgThumbList.scrollHeight;
            bgFileInput.value = '';
        };
        reader.readAsDataURL(file);
    });
}
function initBgTabSwitch() {
    const customTab = document.getElementById('customBgTab');
    const officialTab = document.getElementById('officialBgTab');
    customTab.addEventListener('click', () => {
        currentBgTab = 'custom';
        customTab.classList.add('active');
        officialTab.classList.remove('active');
        renderBgThumbnails(customBgList);
    });
    officialTab.addEventListener('click', () => {
        currentBgTab = 'official';
        officialTab.classList.add('active');
        customTab.classList.remove('active');
        renderBgThumbnails(bgUrlList);
    });
}
initBgTabSwitch();
async function initRandomBg() {
    try {
        const res = await fetch('moguone/background.txt');
        const bgText = await res.text();
        bgUrlList = bgText.replace(/\r\n/g, '\n').split('\n').map(line => line.trim()).filter(line => line);
    } catch (err) { 
        console.log('èƒŒæ™¯åˆ—è¡¨åŠ è½½å¤±è´¥', err); 
        bgUrlList = []; 
    }
    const saveCustomBg = localStorage.getItem(BG_CUSTOM_KEY);
    customBgList = saveCustomBg ? JSON.parse(saveCustomBg) : [];
    allBgList = [...bgUrlList, ...customBgList];
    let saveBgIndex = localStorage.getItem(BG_INDEX_KEY);
    let useBgIndex = 0;
    if(saveBgIndex !== null && saveBgIndex !== '' && !isNaN(saveBgIndex)){
        useBgIndex = parseInt(saveBgIndex);
        if(useBgIndex <0 || useBgIndex >= allBgList.length){
            useBgIndex = allBgList.length - 1 < 0 ? 0 : allBgList.length -1;
        }
    }
    const useBg = allBgList[useBgIndex] || "";
    if(useBg){
        document.body.style.background = `url(${useBg}) no-repeat fixed center center`;
        document.body.style.backgroundSize = "cover";
        document.body.style.backgroundAttachment = "fixed";
        document.body.style.backgroundPosition = "center center";
    }else{
        document.body.style.background = "#151823";
    }
    document.body.style.transition = "background 1.5s ease-in-out";
}
function changeRandomBg() {
    openBgModal();
}
const navLinks = document.querySelectorAll('.main-nav-link');
navLinks.forEach(link => {
    link.addEventListener('click', function(e) {
        if (this.classList.contains('active')) return;
        e.preventDefault();
        const targetHref = this.getAttribute('href');
        if (isAnimating || !targetHref) return;
        isAnimating = true;
        const loader = document.getElementById('loader');
        loader.classList.remove('loaded');
        document.body.style.overflow = 'hidden';
        if (window.saveMusicState) saveMusicState();
        setTimeout(() => {
            window.location.href = targetHref;
            isAnimating = false;
        }, 600);
        setTimeout(() => isAnimating = false, 1000);
    });
});
function initLazyImgLoad() {
    const lazyElements = document.querySelectorAll('img[data-src]');
    if (!imgObserver) {
        imgObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const el = entry.target;
                    el.src = el.dataset.src;
                    el.onload = () => { el.classList.add('loaded'); };
                    imgObserver.unobserve(el);
                }
            });
        }, { rootMargin: '0px 0px 150px 0px', threshold: 0.1 });
    }
    lazyElements.forEach(el => {
        if (!el.classList.contains('loaded')) imgObserver.observe(el);
    });
}
function initVideoHoverPreview() {
    const videos = document.querySelectorAll('video[data-src]');
    if (!videoObserver) {
        videoObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const video = entry.target;
                    video.src = video.dataset.src;
                    video.muted = true;
                    video.loop = false;
                    video.load();
                    video.classList.add('loaded');
                    video.onloadeddata = function() { video.play(); }
                    video.ontimeupdate = function() {
                        if (video.currentTime >=3) {video.currentTime=0;video.play();}
                    }
                    videoObserver.unobserve(video);
                }
            });
        }, { rootMargin: '0px 0px 200px 0px', threshold:0.1 });
    }
    videos.forEach(video => {
        if (!video.classList.contains('loaded')) videoObserver.observe(video);
    });
}
function formatVisitCount(num) {
    if (num >= 1000) {
        return (num / 1000).toFixed(2) + 'K';
    } else {
        return num;
    }
}
let randomJumpTimer = null;
function startRandomJump(element) {
    randomJumpTimer = setInterval(() => {
        const randomNum = Math.floor(Math.random() * 1000);
        element.innerText = formatVisitCount(randomNum);
    }, 40);
}
function stopRandomJump() {
    if (randomJumpTimer) {
        clearInterval(randomJumpTimer);
        randomJumpTimer = null;
    }
}
async function initVisitCount() {
    const totalCountEl = document.getElementById('totalCount');
    startRandomJump(totalCountEl);
    const requestHeaders = {
        "Authorization": `token ${GITHUB_TOKEN}`,
        "Accept": "application/vnd.github.v3+json",
        "User-Agent": "Mozilla/5.0"
    };
    try {
        const issueRes = await fetch(
            `https://api.github.com/repos/${GITHUB_REPO}/issues/${COUNT_ISSUE_NUMBER}`,
            { headers: requestHeaders, method: "GET" }
        );
        if (!issueRes.ok) {
            throw new Error(`Issue #${COUNT_ISSUE_NUMBER} ä¸å­˜åœ¨`);
        }
        const countIssue = await issueRes.json();
        let currentCount = 0;
        const match = countIssue.body.match(COUNT_REG);
        if (match) {
            currentCount = parseInt(match[1]);
        }
        currentCount += 1;
        const newsMatches = countIssue.body.matchAll(NEWS_VIEW_REG);
        for (const m of newsMatches) {
            const newsIndex = parseInt(m[1]);
            const viewCount = parseInt(m[2]);
        }
        newsLikeCounts = {};
        const likeMatches = countIssue.body.matchAll(NEWS_LIKE_REG);
        for (const m of likeMatches) {
            const newsIndex = parseInt(m[1]);
            const likeCount = parseInt(m[2]);
            newsLikeCounts[newsIndex] = likeCount;
        }
        let newIssueBody = `æ€»è®¿é—®é‡ï¼š${currentCount}\n`;
        for (const key in newsLikeCounts) {
            newIssueBody += `${NEWS_LIKE_PREFIX}${key}${NEWS_LIKE_SUFFIX}${newsLikeCounts[key]}\n`;
        }
        await fetch(
            `https://api.github.com/repos/${GITHUB_REPO}/issues/${COUNT_ISSUE_NUMBER}`,
            {
                headers: requestHeaders,
                method: "PATCH",
                body: JSON.stringify({ body: newIssueBody.trim() })
            }
        );
        stopRandomJump();
        totalCountEl.innerText = formatVisitCount(currentCount);
        localStorage.setItem('temp_count_all', JSON.stringify({ total: currentCount, likes: newsLikeCounts }));
        renderNewsLikeCounts();
    } catch (err) {
        console.log('ç»Ÿè®¡å®¹é”™ï¼š', err);
        let localData = JSON.parse(localStorage.getItem('temp_count_all')) || { total: 0, news: {}, likes: {} };
        localData.total += 1;
        newsLikeCounts = localData.likes || {};
        localStorage.setItem('temp_count_all', JSON.stringify(localData));
        stopRandomJump();
        totalCountEl.innerText = formatVisitCount(localData.total);
        renderNewsLikeCounts();
    }
}
function renderNewsLikeCounts() {
    const likeElements = document.querySelectorAll('.news-like-count');
    likeElements.forEach(el => {
        const index = parseInt(el.dataset.index);
        const count = newsLikeCounts[index] || 0;
        el.innerText = formatVisitCount(count);
    });
    const modalLikeElements = document.querySelectorAll('.modal-news-like-count');
    modalLikeElements.forEach(el => {
        const index = parseInt(el.dataset.index);
        const count = newsLikeCounts[index] || 0;
        el.innerText = formatVisitCount(count);
    });
    renderLikedStyle();
}
async function updateNewsLikeCount(index) {
    if (typeof newsLikeCounts[index] === 'undefined') {
        newsLikeCounts[index] = 0;
    }
    newsLikeCounts[index] += 1;
    renderLikedStyle();
    const requestHeaders = {
        "Authorization": `token ${GITHUB_TOKEN}`,
        "Accept": "application/vnd.github.v3+json",
        "User-Agent": "Mozilla/5.0"
    };
    try {
        const issueRes = await fetch(
            `https://api.github.com/repos/${GITHUB_REPO}/issues/${COUNT_ISSUE_NUMBER}`,
            { headers: requestHeaders, method: "GET" }
        );
        if (!issueRes.ok) throw new Error('Issueè¯·æ±‚å¤±è´¥');
        const countIssue = await issueRes.json();
        let currentTotal = 0;
        const totalMatch = countIssue.body.match(COUNT_REG);
        if (totalMatch) currentTotal = parseInt(totalMatch[1]);
        const tempNewsLikes = {};
        const likeMatches = countIssue.body.matchAll(NEWS_LIKE_REG);
        for (const m of likeMatches) {
            tempNewsLikes[parseInt(m[1])] = parseInt(m[2]);
        }
        tempNewsLikes[index] = newsLikeCounts[index];
        newsLikeCounts = tempNewsLikes;
        let newIssueBody = `æ€»è®¿é—®é‡ï¼š${currentTotal}\n`;
        for (const key in tempNewsLikes) {
            newIssueBody += `${NEWS_LIKE_PREFIX}${key}${NEWS_LIKE_SUFFIX}${tempNewsLikes[key]}\n`;
        }
        await fetch(
            `https://api.github.com/repos/${GITHUB_REPO}/issues/${COUNT_ISSUE_NUMBER}`,
            {
                headers: requestHeaders,
                method: "PATCH",
                body: JSON.stringify({ body: newIssueBody.trim() })
            }
        );
        localStorage.setItem('temp_count_all', JSON.stringify({ 
            total: currentTotal, 
            likes: newsLikeCounts 
        }));
    } catch (err) {
        console.log('æ–°é—»ç‚¹èµžé‡å®¹é”™ï¼š', err);
        let localData = JSON.parse(localStorage.getItem('temp_count_all')) || { total: 0, likes: {} };
        localData.likes[index] = newsLikeCounts[index];
        localStorage.setItem('temp_count_all', JSON.stringify(localData));
    }
}
function renderLikedStyle() {
    document.querySelectorAll('.news-like-btn').forEach(btn => {
        const index = parseInt(btn.dataset.index);
        const count = formatVisitCount(newsLikeCounts[index] || 0);
        btn.innerHTML = `ðŸ‘ <span class="news-like-count" data-index="${index}">${count}</span>`;
        void btn.offsetWidth;
    });
    document.querySelectorAll('.modal-news-like-btn').forEach(btn => {
        const index = parseInt(btn.dataset.index);
        const count = formatVisitCount(newsLikeCounts[index] || 0);
        btn.innerHTML = `ðŸ‘ <span class="modal-news-like-count" data-index="${index}">${count}</span>`;
        void btn.offsetWidth;
    });
}
function initTheme() {
    const themeToggle = document.getElementById('themeToggle');
    const htmlDom = document.documentElement;
    const savedTheme = localStorage.getItem('theme_mode');
    if(savedTheme==='light'){
        htmlDom.setAttribute('data-theme-mode','light');
        themeToggle.checked = true;
    } else {
        htmlDom.setAttribute('data-theme-mode','dark');
        themeToggle.checked = false;
    }
    themeToggle.addEventListener('change', function() {
        if(this.checked){
            htmlDom.setAttribute('data-theme-mode','light');
            localStorage.setItem('theme_mode','light');
        } else {
            htmlDom.setAttribute('data-theme-mode','dark');
            localStorage.setItem('theme_mode','dark');
        }
    });
}
function openNewsModal(index) {
    currentModalIndex = index;
    const newsData = newsDataList[index];
    const modalContent = document.getElementById('modalNewsContent');
    let imgHtml = '';
    if(newsData.imgSrcList.length>0||newsData.videoSrcList.length>0) {
        imgHtml = `<div class="modal-news-imgs">`;
        newsData.imgSrcList.forEach(url=>{
            imgHtml+=`<img class="modal-news-img-item" data-src="${url}" alt="${newsData.title}" src="">`;
        });
        newsData.videoSrcList.forEach(url=>{
            imgHtml+=`<video class="modal-news-img-item" tag="video" data-src="${url}" muted playsinline preload="metadata"></video>`;
        });
        imgHtml += `</div>`;
    }
    modalContent.innerHTML = `
        <div class="modal-news-title">${newsData.title}</div>
        <div class="modal-news-desc">${newsData.content}</div>
        ${imgHtml}
        <div class="modal-news-date"><span class="modal-news-like-btn" data-index="${index}">ðŸ‘ <span class="modal-news-like-count" data-index="${index}">${formatVisitCount(newsLikeCounts[index] || 0)}</span></span> | å‘å¸ƒæ—¶é—´ï¼š${newsData.date}</div>
    `;
    const modalCommentArea = document.getElementById('modalCommentArea');
    modalCommentArea.innerHTML = `
      <div class="apple-loading-comment" style="text-align:center; padding:20px; color:var(--color-green); font-weight:300; letter-spacing:0.5px;">
        <span style="display:inline-flex; align-items:center; gap:8px;">
          Loading
          <span style="display:flex; gap:2px; margin-top:2px;">
            <span style="width:4px; height:4px; border-radius:50%; background:var(--color-green); animation: apple-breathe 1.2s infinite ease-in-out 0s;"></span>
            <span style="width:4px; height:4px; border-radius:50%; background:var(--color-green); animation: apple-breathe 1.2s infinite ease-in-out 0.2s;"></span>
            <span style="width:4px; height:4px; border-radius:50%; background:var(--color-green); animation: apple-breathe 1.2s infinite ease-in-out 0.4s;"></span>
          </span>
        </span>
      </div>
      <style>
        @keyframes apple-breathe {
          0%, 100% { opacity: 0.4; transform: scale(0.9); }
          50% { opacity: 1; transform: scale(1.1); }
        }
        .apple-loading-comment {
          transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
      </style>
    `;
    const commentArea = document.getElementById('modalCommentArea');
    if (!commentArea.dataset.loading) {
        commentArea.dataset.loading = 'true';
        getCommentData(index).then(() => {
            renderNewsLikeCounts();
            renderLikedStyle();
            renderCommentArea(index);
            delete commentArea.dataset.loading;
        });
    }
    renderLikedStyle();
    updateNavBtnStatus();
    const modalMask = document.getElementById('newsModalMask');
    modalMask.classList.add('show');
    scrollTopVal=window.scrollY;
    document.body.style.overflow='hidden';
    setTimeout(()=>{
        initPreviewAnimation();
        initLazyImgLoad();
        initVideoHoverPreview();
        const modalLikeBtn = document.querySelector('.modal-news-like-btn');
        if(modalLikeBtn) {
            modalLikeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                updateNewsLikeCount(index);
            });
        }
    },100);
}
function createModalCommentArea(index) {
    const modalCommentArea = document.getElementById('modalCommentArea');
    modalCommentArea.innerHTML = '';
    const utterContainer = document.createElement('div');
    utterContainer.className='modal-utter-container';
    modalCommentArea.appendChild(utterContainer);
    const utterScript = document.createElement('script');
    utterScript.src='https://utteranc.es/client.js';
    utterScript.setAttribute('repo',GITHUB_REPO);
    utterScript.setAttribute('issue-term',`news_${index}`);
    utterScript.setAttribute('theme',getUtterancesTheme());
    utterScript.setAttribute('crossorigin','anonymous');
    utterScript.setAttribute('async',true);
    utterContainer.appendChild(utterScript);
}
function closeNewsModal() {
    const modalMask = document.getElementById('newsModalMask');
    modalMask.classList.remove('show');
    document.body.style.overflow='auto';
    window.scrollTo(0,scrollTopVal);
    currentModalIndex=-1;
    document.querySelectorAll('.modal-news-img-item[tag=video]').forEach(v=>v.pause());
    document.getElementById('modalCommentArea').innerHTML = '';
}
function switchNews(direction) {
    if (currentModalIndex === -1 || newsDataList.length === 0) return;
    let newIndex = currentModalIndex;
    if (direction === 'prev') {
        newIndex = currentModalIndex - 1;
    } else if (direction === 'next') {
        newIndex = currentModalIndex + 1;
    }
    if (newIndex < 0 || newIndex >= newsDataList.length) return;
    closeNewsModal();
    setTimeout(() => {
        openNewsModal(newIndex);
    }, 100);
}
function updateNavBtnStatus() {
    const prevBtn = document.getElementById('newsPrevBtn');
    const nextBtn = document.getElementById('newsNextBtn');
    if (!prevBtn || !nextBtn || currentModalIndex === -1) return;
    prevBtn.disabled = currentModalIndex === 0;
    nextBtn.disabled = currentModalIndex === newsDataList.length - 1;
}
function showTipModal() {
    const tipMask = document.getElementById('tipModalMask');
    tipMask.classList.add('show');
    document.body.style.overflow = 'hidden';
}
function hideTipModal() {
    const tipMask = document.getElementById('tipModalMask');
    tipMask.classList.remove('show');
    document.body.style.overflow = 'auto';
}
function initNewsScrollAnimation() {
    const newsItems = document.querySelectorAll('.news-item');
    if (newsAnimateObserver) {
        newsAnimateObserver.disconnect();
        newsAnimateObserver = null;
    }
    newsAnimateObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            const newsItem = entry.target;
            if (entry.isIntersecting) {
                newsItem.classList.add('active');
                newsItem.classList.remove('out');
            } else {
                newsItem.classList.add('out');
                newsItem.classList.remove('active');
            }
        });
    }, {
        root: null,
        rootMargin: "0px 0px 100px 0px",
        threshold: 0.05
    });
    newsItems.forEach(item => {
        newsAnimateObserver.observe(item);
    });
}
function renderNewsList(newsList) {
    const newsContainer = document.getElementById('newsScroll');
    showLoadingToast();
    newsContainer.innerHTML = '';
    if(newsList.length === 0) {
        newsContainer.innerHTML = '<div class="search-empty-tips">ðŸ” æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å†…å®¹ï¼Œè¯•è¯•æ¢ä¸ªå…³é”®è¯å§</div>';
        return;
    }
    const resourcesToLoad = [];
    newsList.forEach((newsData) => {
        const originalIndex = newsDataList.indexOf(newsData);
        const item = document.createElement('div');
        item.className='news-item';
        let mediaHtml = '';
        let firstMedia = null;
        if(newsData.imgSrcList.length>0){
            firstMedia={type:'image',url:newsData.imgSrcList[0]};
            mediaHtml = `<img class="news-img-item" data-src="${firstMedia.url}" alt="${newsData.title}" src="">`;
        }else if(newsData.videoSrcList.length>0){
            firstMedia={type:'video',url:newsData.videoSrcList[0]};
            mediaHtml = `<video class="news-video-item" tag="video" data-src="${firstMedia.url}" muted playsinline preload="metadata"></video>`;
        }
        item.innerHTML = `
            <div class="news-text-box">
                <div class="news-title">${newsData.title}</div>
                <div class="news-content">${newsData.content}</div>
                <div class="news-date"><span class="news-like-btn" data-index="${originalIndex}">ðŸ‘ <span class="news-like-count" data-index="${originalIndex}">${formatVisitCount(newsLikeCounts[originalIndex] || 0)}</span></span> | ðŸ“… ${newsData.date}</div>
            </div>
            <div class="news-media-box">${mediaHtml}</div>
        `;
        newsContainer.appendChild(item);
        createCommentArea(item, originalIndex);
        const newsTitleEl = item.querySelector('.news-title');
        newsTitleEl.addEventListener('click', () => {
            openNewsModal(originalIndex);
        });
        const newsLikeBtn = item.querySelector('.news-like-btn');
        newsLikeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            updateNewsLikeCount(originalIndex);
        });
        if(firstMedia) resourcesToLoad.push(firstMedia);
    });
    Promise.all(resourcesToLoad.map(resource=>{
        return new Promise((resolveLoad)=>{
            if(resource.type==='image'){
                const img=new Image();
                img.onload=resolveLoad;
                img.onerror=resolveLoad;
                img.src=resource.url;
            }else{
                const video=document.createElement('video');
                video.preload='metadata';
                video.onloadedmetadata=resolveLoad;
                video.onerror=resolveLoad;
                video.src=resource.url;
            }
        });
    })).then(()=>{
        initLazyImgLoad();
        initVideoHoverPreview();
        initPreviewAnimation();
        initNewsScrollAnimation();
        showSuccessToast();
    });
}
function loadNewsContent() {
    const newsContainer = document.getElementById('newsScroll');
        newsContainer.innerHTML = `<div class="news-loading">âœ¨ åŠ è½½æ—¥è®°å†…å®¹ä¸­...</div>`;
        const requestHeaders = {
            "Authorization": `token ${GITHUB_TOKEN}`,
            "Accept": "application/vnd.github.v3+json",
            "User-Agent": "Mozilla/5.0"
        };
        return new Promise((resolve) => {
            fetch(`https://api.github.com/repos/${GITHUB_REPO}/issues/${NEWS_ISSUE_NUMBER}`, {
                headers: requestHeaders,
                method: "GET"
            })
            .then(res => {
                if (!res.ok) throw new Error(`èŽ·å–Issueå¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š${res.status}`);
                return res.json();
            })
            .then(issueData => {
                const issueBody = issueData.body || '';
                const newsList = issueBody.replace(/\r\n/g,'\n').split(NEWS_SEPARATOR).map(n=>n.trim()).filter(n=>n.length);
                newsDataList = [];
                newsList.forEach((newsStr, index) => {
                    let title="æœ€æ–°æ—¥è®°",content="",imgSrcList=[],videoSrcList=[],date="2026-01-18 00:00";
                    let id = 0;
                    newsStr.split('\n').map(l=>l.trim()).filter(l=>l).forEach(line=>{
                        if(line.startsWith('id::')) id = parseInt(line.slice(4)) || 0;
                        else if(line.startsWith('ã€')&&line.endsWith('ã€‘')) title=line.slice(1,-1);
                        else if(line.startsWith('img::')) imgSrcList.push(line.slice(5));
                        else if(line.startsWith('video::')) videoSrcList.push(line.slice(7));
                        else if(line.startsWith('date::')) date=line.slice(5);
                        else content += line + '<br>';
                    });
                    newsDataList.push({id: id || (index + 1), title,content,imgSrcList,videoSrcList,date});
                });
                newsDataList = newsDataList.sort((a, b) => a.id - b.id);
                initNewsLikeCounts(); 
                renderNewsList(newsDataList);
                renderNewsLikeCounts(); 
                renderLikedStyle();     
                preloadAllMedia();
                resolve();
            })
        .catch((err)=>{
            console.error('åŠ è½½æ—¥è®°å¤±è´¥ï¼š', err);
            const toast = document.getElementById('toastNotification');
            toast.classList.remove('show');
            setTimeout(() => {
                const spinner = toast.querySelector('.loading-spinner');
                const successIcon = toast.querySelector('.success-icon');
                toast.querySelector('.text').textContent = 'æ—¥è®°åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•';
                spinner.style.display = 'none';
                successIcon.style.display = 'inline-block';
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }, 300);
            newsContainer.innerHTML='';
            const errorDom=document.createElement('div');
            errorDom.className='news-item';
            errorDom.style.color='#38a169';
            errorDom.style.textAlign='center';
            errorDom.style.padding='30px';
            errorDom.textContent='æ—¥è®°åŠ è½½å¤±è´¥ âœ˜ï¼Œè¯·æ£€æŸ¥GitHub Issueé…ç½®æˆ–ç½‘ç»œ';
            newsContainer.appendChild(errorDom);
            fetch('moguone/news.txt')
                .then(res => res.text())
                .then(text => {
                    const newsList = text.replace(/\r\n/g,'\n').split('---').map(n=>n.trim()).filter(n=>n.length);
                    newsDataList = [];
                    newsList.forEach((newsStr, index) => {
                        let title="æœ€æ–°æ—¥è®°",content="",imgSrcList=[],videoSrcList=[],date="2026-01-18 00:00";
                        let id = 0;
                        newsStr.split('\n').map(l=>l.trim()).filter(l=>l).forEach(line=>{
                            if(line.startsWith('id::')) id = parseInt(line.slice(4)) || 0;
                            else if(line.startsWith('ã€')&&line.endsWith('ã€‘')) title=line.slice(1,-1);
                            else if(line.startsWith('img::')) imgSrcList.push(line.slice(5));
                            else if(line.startsWith('video::')) videoSrcList.push(line.slice(7));
                            else if(line.startsWith('date::')) date=line.slice(5);
                            else content += line + '<br>';
                        });
                        newsDataList.push({title,content,imgSrcList,videoSrcList,date});
                    });
                    initNewsLikeCounts();
                    renderNewsList(newsDataList);
                    renderNewsLikeCounts();
                    renderLikedStyle();
                });
            resolve();
        });
    });
}
function showLoadingToast() {
    const toast = document.getElementById('toastNotification');
    const spinner = toast.querySelector('.loading-spinner');
    const successIcon = toast.querySelector('.success-icon');
    toast.querySelector('.text').innerHTML = 'é¦–æ¬¡åŠ è½½æ–°æ—¥è®°è¾ƒæ…¢<br>è¯· æ‰£æ‰‹æŒ‡ è€å¿ƒç­‰å¾…';
    spinner.style.display = 'inline-block';
    successIcon.style.display = 'none';
    toast.classList.add('show');
}
function showSuccessToast() {
    const toast = document.getElementById('toastNotification');
    const spinner = toast.querySelector('.loading-spinner');
    const successIcon = toast.querySelector('.success-icon');
    toast.classList.remove('show');
    setTimeout(() => {
        toast.querySelector('.text').textContent = 'æ—¥è®°èŽ·å–æˆåŠŸ';
        spinner.style.display = 'none';
        successIcon.style.display = 'inline-block';
        toast.classList.add('show');
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }, 300);
}
function initSearchFunc() {
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const resetBtn = document.getElementById('resetBtn');
    let searchDebounce = null;

    const doSearch = () => {
        const keyword = searchInput.value.trim().toLowerCase();
        if (!keyword) {
            showTipModal();
            searchInput.focus();
            return;
        }
        const filterList = newsDataList.filter(item => {
            return item.title.toLowerCase().includes(keyword) || item.content.toLowerCase().includes(keyword);
        });
        renderNewsList(filterList);
    }

    searchBtn.addEventListener('click', doSearch);
    searchInput.addEventListener('keyup', (e) => {
        if(e.key === 'Enter') {
            clearTimeout(searchDebounce);
            doSearch();
        }
    });

    resetBtn.addEventListener('click', () => {
        searchInput.value = '';
        document.getElementById('imgPreviewMask').classList.remove('show');
        closeNewsModal();
        renderNewsList(newsDataList);
        searchInput.focus();
        window.scrollTo({top: 0, behavior: 'smooth'});
    });
}
function refreshNewsContent() {
    loadNewsContent();
    const toast = document.getElementById('toastNotification');
    toast.querySelector('.text').textContent = 'æ—¥è®°å·²åˆ·æ–°ï¼';
    toast.classList.add('show');
    setTimeout(() => {
        toast.classList.remove('show');
    }, 2000);
}
function preloadAllMedia() {
    if (!newsDataList || newsDataList.length === 0) return;
    console.log('å¼€å§‹é¢„åŠ è½½æ‰€æœ‰æ—¥è®°çš„åª’ä½“èµ„æº...');
    const preloadPromises = [];
    newsDataList.forEach((newsData, index) => {
        newsData.imgSrcList.forEach(imgUrl => {
            preloadPromises.push(new Promise((resolve) => {
                const img = new Image();
                img.onload = resolve;
                img.onerror = resolve;
                img.src = imgUrl;
            }));
        });
        newsData.videoSrcList.forEach(videoUrl => {
            preloadPromises.push(new Promise((resolve) => {
                const video = document.createElement('video');
                video.preload = 'metadata';
                video.onloadedmetadata = resolve;
                video.onerror = resolve;
                video.src = videoUrl;
            }));
        });
    });
    Promise.all(preloadPromises).then(() => {
        console.log('æ‰€æœ‰æ—¥è®°åª’ä½“èµ„æºé¢„åŠ è½½å®Œæˆï¼');
        initLazyImgLoad();
        initVideoHoverPreview();
    });
}
function initPreviewAnimation() {
    const mask = document.getElementById('imgPreviewMask');
    const previewImg = document.getElementById('previewImg');
    const previewVideo = document.getElementById('previewVideo');
    const previewCloseBtn = document.getElementById('previewCloseBtn');
    const previewPrevBtn = document.getElementById('previewPrevBtn');
    const previewNextBtn = document.getElementById('previewNextBtn');
    const previewPagination = document.getElementById('previewPagination');
    let currentMediaList = [];
    let currentMediaIndex = 0;
    function updatePreviewContent(index) {
        if (currentMediaList.length === 0) return;
        previewImg.classList.remove('show-animate');
        previewVideo.classList.remove('show-animate');
        setTimeout(() => {
            currentMediaIndex = index;
            if (currentMediaIndex < 0) currentMediaIndex = currentMediaList.length - 1;
            if (currentMediaIndex >= currentMediaList.length) currentMediaIndex = 0;
            previewPrevBtn.disabled = currentMediaList.length <= 1 || currentMediaIndex === 0;
            previewNextBtn.disabled = currentMediaList.length <= 1 || currentMediaIndex === currentMediaList.length - 1;
            previewPagination.textContent = `${currentMediaIndex + 1}/${currentMediaList.length}`;
            const media = currentMediaList[currentMediaIndex];
            previewImg.style.display = 'none';
            previewVideo.style.display = 'none';
            previewVideo.pause();
            previewVideo.currentTime = 0;
            previewVideo.muted = false;
            if (media.type === 'image') {
                previewImg.src = media.url;
                previewImg.style.display = 'block';
                setTimeout(() => previewImg.classList.add('show-animate'), 50);
            } else if (media.type === 'video') {
                previewVideo.src = media.url;
                previewVideo.style.display = 'block';
                setTimeout(() => {
                    previewVideo.classList.add('show-animate');
                    previewVideo.play().catch(e => {});
                }, 50);
            }
        }, 200);
    }
    previewPrevBtn.addEventListener('click', () => {
        updatePreviewContent(currentMediaIndex - 1);
    });
    previewNextBtn.addEventListener('click', () => {
        updatePreviewContent(currentMediaIndex + 1);
    });
    document.addEventListener('keydown', (e) => {
        if (mask.classList.contains('show')) {
            if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                e.preventDefault();
            }
            if (e.key === 'ArrowLeft') {
                updatePreviewContent(currentMediaIndex - 1);
            } else if (e.key === 'ArrowRight') {
                updatePreviewContent(currentMediaIndex + 1);
            } else if (e.key === 'Escape') {
                closePreview();
            }
        }
        else if (document.getElementById('newsModalMask').classList.contains('show')) {
            if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                e.preventDefault();
            }
            if (e.key === 'ArrowUp') {
                switchNews('next');
            } else if (e.key === 'ArrowDown') {
                switchNews('prev');
            } else if (e.key === 'Escape') {
                closeNewsModal();
            }
        }
    });
    function closePreview() {
        mask.classList.remove('show');
        if(!document.getElementById('newsModalMask').classList.contains('show')) {
            document.body.style.overflow = 'auto';
            window.scrollTo(0, scrollTopVal);
        }
        previewVideo.pause();
        previewVideo.src = '';
        previewVideo.muted = true;
        previewImg.src = '';
        currentMediaList = [];
        currentMediaIndex = 0;
    }
    mask.addEventListener('click', function(e) {
        if(e.target === mask) {
            closePreview();
        }
    });
    previewCloseBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        closePreview();
    });
    const mediaItems = document.querySelectorAll('.news-img-item, .news-video-item, .modal-news-img-item');
    mediaItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.stopPropagation();
            scrollTopVal = window.scrollY;
            document.body.style.overflow = 'hidden';
            mask.classList.add('show');
            const newsItem = this.closest('.news-item') || this.closest('.modal-news-imgs');
            const currentNewsIndex = currentModalIndex >= 0 ? currentModalIndex : Array.from(document.querySelectorAll('.news-item')).indexOf(newsItem);
            if (currentNewsIndex >= 0 && newsDataList[currentNewsIndex]) {
                const newsData = newsDataList[currentNewsIndex];
                currentMediaList = [];
                newsData.imgSrcList.forEach(url => {
                    currentMediaList.push({ type: 'image', url });
                });
                newsData.videoSrcList.forEach(url => {
                    currentMediaList.push({ type: 'video', url });
                });
                const currentUrl = this.src || this.dataset.src;
                currentMediaIndex = currentMediaList.findIndex(media => media.url === currentUrl);
                if (currentMediaIndex === -1) currentMediaIndex = 0;
                updatePreviewContent(currentMediaIndex);
            } else {
                currentMediaList = [{ 
                    type: this.tagName === 'IMG' ? 'image' : 'video', 
                    url: this.src || this.dataset.src 
                }];
                currentMediaIndex = 0;
                previewImg.classList.remove('show-animate');
                previewVideo.classList.remove('show-animate');
                updatePreviewContent(0);
            }
        });
    });
}
function initMusicPlayer() {
    const playBtn = document.getElementById('playBtn');
    const music = document.getElementById('music');
    const footer = document.getElementById('footer');
    music.volume = 0.5;
    let isPlay = false;
    const musicState = JSON.parse(localStorage.getItem('musicPlayerState')) || {
        isPlay: false,
        currentTime: 0,
        volume: 0.5
    };
    music.volume = musicState.volume;
    music.currentTime = musicState.currentTime;
    isPlay = musicState.isPlay;
    if (isPlay) {
        playBtn.className = 'music-btn pause-icon';
        footer.className = 'music-playing';
        music.play().then(() => {}).catch(e => {});
    } else {
        playBtn.className = 'music-btn play-icon';
        footer.className = 'music-paused';
        music.pause();
    }
    playBtn.addEventListener('click', function() {
        if (isPlay) {
            music.pause();
            playBtn.className = 'music-btn play-icon';
            footer.className = 'music-paused';
            isPlay = false;
        } else {
            music.play().then(() => {
                playBtn.className = 'music-btn pause-icon';
                footer.className = 'music-playing';
                isPlay = true;
            }).catch(e => {});
        }
        saveMusicState();
    });
    music.addEventListener('timeupdate', function() {
        saveMusicState();
    });
    function saveMusicState() {
        localStorage.setItem('musicPlayerState', JSON.stringify({
            isPlay: isPlay,
            currentTime: music.currentTime,
            volume: music.volume
        }));
    }
    setTimeout(() => {
        if (!isPlay) {
            music.play().then(() => {
                playBtn.className = 'music-btn pause-icon';
                footer.className = 'music-playing';
                isPlay = true;
                saveMusicState();
            }).catch(e => {});
        }
    }, 1500);
}
async function initPageWithLoader() {
    const loader = document.getElementById('loader');
    document.body.style.overflow = 'hidden';
    await Promise.all([
        loadNewsContent(),
        new Promise(resolve => setTimeout(resolve, 1000))
    ]);
    setTimeout(() => {
        loader.classList.add('loaded');
        document.body.style.overflow = 'auto';
        initTheme();
        initVisitCount();
        initMusicPlayer();
        initSearchFunc();
        initAddBgFunc();
        if (newsDataList && newsDataList.length > 0) {
            preloadAllMedia();
        }
    }, 300);
}
document.addEventListener('DOMContentLoaded', function() {
    const loader = document.getElementById('loader');
    loader.classList.remove('loaded');
    initLoginState();
    initCustomBg();
    initRandomBg();
    document.getElementById('bgChangeBtn').addEventListener('click', changeRandomBg);
    document.getElementById('bgModalCloseBtn').addEventListener('click', function(e) {
        e.stopPropagation();
        closeBgModal();
    });
    fetch('moguone/log.txt').then(res => res.text()).then(text => {
        const logContainer = document.querySelector('.sidebar-update-log');
        text.replace(/\r\n/g, '\n').split('\n').filter(l => l.trim()).forEach(line => {
            const dom = document.createElement('div');
            if (line.startsWith('V')) {
                dom.className = 'update-log-version';
            } else if (line.startsWith('20')) {
                dom.className = 'update-log-time-text';
            } else {
                dom.className = 'update-log-content';
            }
            dom.textContent = line.trim();
            logContainer.appendChild(dom);
        });
    }).catch(() => {
        const dom = document.createElement('div');
        dom.className = 'update-log-content';
        dom.style.color = '#38a169';
        dom.textContent = ' æ—¥å¿—åŠ è½½å¤±è´¥ âœ˜ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„ ';
        document.querySelector('.sidebar-update-log').appendChild(dom);
    });
    initPageWithLoader();
    document.getElementById('modalCloseBtn').addEventListener('click', function(e) {
        e.stopPropagation();
        closeNewsModal();
    });
    document.getElementById('newsPrevBtn').addEventListener('click', () => {
        switchNews('prev');
    });
    document.getElementById('newsNextBtn').addEventListener('click', () => {
        switchNews('next');
    });
    document.getElementById('newsModalMask').addEventListener('click', function(e) {
        if(e.target === this) closeNewsModal();
    });
    document.getElementById('tipModalCloseBtn').addEventListener('click', function(e) {
        e.stopPropagation();
        hideTipModal();
    });
    document.getElementById('tipModalMask').addEventListener('click', function(e) {
        if(e.target === this) hideTipModal();
    });
    document.getElementById('sidebarTop').addEventListener('click', () => {
        window.scrollTo({top: 0, behavior: 'smooth'});
    });
    function initUserDropdown() {
      const userInfoBox = document.getElementById('userInfoBox');
      if (!userInfoBox) return;
      const trigger = userInfoBox.querySelector('.user-dropdown-trigger');
      const menu = userInfoBox.querySelector('.user-dropdown-menu');
      trigger.addEventListener('click', (e) => {
        e.stopPropagation();
        menu.classList.toggle('show');
      });
      document.addEventListener('click', () => {
        menu.classList.remove('show');
      });
      menu.addEventListener('click', (e) => {
        e.stopPropagation();
      });
    }
    initUserDropdown();
});
</script>
</body>
</html>
