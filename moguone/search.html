<!DOCTYPE html>
<html lang="en">
<head>
<link rel="dns-prefetch" href="https://cn.bing.com">
<link rel="dns-prefetch" href="https://www.google.com">
<link rel="dns-prefetch" href="https://www.baidu.com">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mogu Search</title>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: "Inter", "SF Pro Display", "Microsoft YaHei", sans-serif;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
#search-input {
-webkit-user-select: text;
-moz-user-select: text;
-ms-user-select: text;
user-select: text;
}
body {
background-color: #f5f7fa;
display: flex;
flex-direction: column;
justify-content: flex-start;
align-items: center;
min-height: 100vh;
padding: 15vh 20px 40px;
position: relative;
}
.search-title {
font-size: 40px;
font-weight: 600;
color: #0078d4;
margin-bottom: 36px;
letter-spacing: 1px;
transition: all 0.25s ease-out;
cursor: default;
text-shadow: 0 2px 4px rgba(0, 120, 212, 0.05);
}
.search-title:hover {
color: #0066b8;
transform: scale(1.03);
}
.search-container {
width: 100%;
max-width: 720px;
display: flex;
align-items: center;
gap: 10px;
position: relative;
margin-bottom: 20px;
}
.search-engine-wrap {
position: relative;
}
.search-engine-select {
padding: 18px 40px 18px 24px;
font-size: 17px;
border: none;
border-radius: 24px;
background: linear-gradient(145deg, #ffffff, #f8f9fa);
color: #2d3748;
outline: none;
appearance: none;
cursor: pointer;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
box-shadow: 
0 4px 12px rgba(0, 0, 0, 0.05),
inset 0 1px 0 rgba(255, 255, 255, 0.8);
min-width: 110px;
font-weight: 500;
}
.search-engine-arrow {
position: absolute;
right: 20px;
top: 50%;
transform: translateY(-50%);
width: 10px;
height: 10px;
pointer-events: none;
transition: all 0.2s ease;
}
.search-engine-arrow::before {
content: "";
display: block;
width: 7px;
height: 7px;
border-right: 2px solid #0078d4;
border-bottom: 2px solid #0078d4;
transform: rotate(45deg);
transition: all 0.2s ease;
opacity: 0.7;
}
.search-engine-select:hover {
box-shadow: 
0 6px 16px rgba(0, 0, 0, 0.08),
inset 0 1px 0 rgba(255, 255, 255, 0.9);
transform: translateY(-1px);
}
.search-engine-select:focus {
box-shadow: 
0 0 0 4px rgba(0, 120, 212, 0.12),
0 6px 16px rgba(0, 120, 212, 0.1),
inset 0 1px 0 rgba(255, 255, 255, 0.9);
transform: translateY(-2px);
}
.search-engine-select:hover + .search-engine-arrow::before,
.search-engine-select:focus + .search-engine-arrow::before {
opacity: 1;
transform: rotate(45deg) scale(1.1);
}
.search-engine-select option {
padding: 12px 16px;
background: #ffffff;
color: #2d3748;
border-radius: 8px;
font-weight: 500;
}
.search-engine-select option:hover {
background: #e8f4ff;
}
#search-input {
flex: 1;
padding: 18px 24px;
font-size: 17px;
border: none;
border-radius: 24px;
outline: none;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
box-shadow: 
0 4px 12px rgba(0, 0, 0, 0.05),
inset 0 1px 0 rgba(255, 255, 255, 0.8);
color: #2d3748;
font-weight: 500;
}
#search-input:focus {
box-shadow: 
0 0 0 4px rgba(0, 120, 212, 0.12),
0 6px 16px rgba(0, 120, 212, 0.1),
inset 0 1px 0 rgba(255, 255, 255, 0.9);
transform: translateY(-2px);
}
#search-input::placeholder {
color: #94a3b8;
font-size: 16px;
font-weight: 400;
}
#search-btn {
padding: 18px 36px;
font-size: 17px;
background: linear-gradient(135deg, #0078d4 0%, #0066b8 100%);
color: white;
border: none;
border-radius: 24px;
cursor: pointer;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
box-shadow: 0 4px 12px rgba(0, 120, 212, 0.15);
font-weight: 500;
}
#search-btn:hover {
background: linear-gradient(135deg, #0066b8 0%, #005599 100%);
transform: translateY(-2px);
box-shadow: 0 6px 16px rgba(0, 120, 212, 0.2);
}
#search-btn:active {
transform: translateY(0);
box-shadow: 0 2px 8px rgba(0, 120, 212, 0.15);
}
.history-rank-wrap {
width: 100%;
max-width: 720px;
margin-top: 65px;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
opacity: 1;
height: auto;
overflow: hidden;
}
.history-rank-wrap.hidden {
opacity: 0;
height: 0;
margin-top: 0;
}
.toggle-btn {
position: fixed;
bottom: 20px;
left: 20px;
width: 36px;
height: 36px;
border-radius: 50%;
background: linear-gradient(145deg, #ffffff, #f8f9fa);
border: none;
box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
transition: all 0.2s ease;
z-index: 9998;
opacity: 0.3;
pointer-events: auto;
}
.toggle-btn:hover {
transform: scale(1.1);
box-shadow: 0 3px 10px rgba(0, 120, 212, 0.12);
opacity: 1;
}
.toggle-btn svg {
width: 18px;
height: 18px;
fill: #0078d4;
transition: all 0.2s ease;
}
.history-rank-container {
display: flex;
gap: 20px;
background: linear-gradient(145deg, #ffffff, #f8f9fa);
border-radius: 20px;
padding: 20px;
box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
margin-top: 10px;
}
.history-section {
flex: 1;
}
.rank-section {
flex: 1;
}
.module-title {
font-size: 16px;
font-weight: 600;
color: #2d3748;
margin-bottom: 12px;
display: flex;
align-items: center;
justify-content: flex-start;
gap: 8px;
cursor: default;
}
.module-title svg {
width: 18px;
height: 18px;
fill: #0078d4;
}
.history-switch-wrap {
display: flex;
align-items: center;
gap: 8px;
margin-left: auto;
}
.switch-label {
font-size: 11px;
color: #64748b;
font-weight: 400;
}
.toggle-switch {
position: relative;
display: inline-block;
width: 36px;
height: 20px;
cursor: pointer;
}
.toggle-switch input {
opacity: 0;
width: 0;
height: 0;
}
.switch-slider {
position: absolute;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: linear-gradient(145deg, #e2e8f0, #f1f5f9);
box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
border-radius: 24px;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.switch-slider:before {
position: absolute;
content: "";
height: 14px;
width: 14px;
left: 3px;
bottom: 3px;
background: linear-gradient(145deg, #ffffff, #f8f9fa);
box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
border-radius: 50%;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
input:checked + .switch-slider {
background: linear-gradient(135deg, #0078d4 0%, #0066b8 100%);
}
input:checked + .switch-slider:before {
transform: translateX(16px);
}
.toggle-switch:hover .switch-slider {
box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.08);
}
input:checked + .switch-slider:hover {
box-shadow: 0 0 0 8px rgba(0, 120, 212, 0.12);
}
.history-list, .rank-list {
list-style: none;
max-height: 210px;
overflow-y: auto;
padding-right: 8px;
}
.history-list::-webkit-scrollbar, .rank-list::-webkit-scrollbar {
width: 4px;
}
.history-list::-webkit-scrollbar-track, .rank-list::-webkit-scrollbar-track {
background: #f1f5f9;
border-radius: 2px;
}
.history-list::-webkit-scrollbar-thumb, .rank-list::-webkit-scrollbar-thumb {
background: #cbd5e1;
border-radius: 2px;
}
.history-list::-webkit-scrollbar-thumb:hover, .rank-list::-webkit-scrollbar-thumb:hover {
background: #94a3b8;
}
.history-item {
padding: 8px 12px;
border-radius: 12px;
margin-bottom: 8px;
display: flex;
justify-content: space-between;
align-items: center;
background: #f8fafc;
transition: all 0.2s ease;
cursor: pointer;
}
.history-item:hover {
background: #e8f4ff;
transform: translateX(2px);
}
.history-item .keyword {
font-size: 14px;
color: #2d3748;
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
flex: 1;
}
.history-item .time {
font-size: 12px;
color: #94a3b8;
margin-left: 8px;
}
.history-item .delete-btn {
width: 24px;
height: 24px;
border-radius: 50%;
border: none;
background: transparent;
color: #94a3b8;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
transition: all 0.2s ease;
margin-left: 8px;
}
.history-item .delete-btn:hover {
background: #fef2f2;
color: #ef4444;
}
.rank-item {
padding: 8px 12px;
border-radius: 12px;
margin-bottom: 8px;
display: flex;
align-items: center;
background: #f8fafc;
transition: all 0.2s ease;
cursor: pointer;
}
.rank-item:hover {
background: #e8f4ff;
transform: translateX(2px);
}
.rank-item .rank-num {
width: 20px;
height: 20px;
border-radius: 50%;
background: #0078d4;
color: white;
font-size: 12px;
display: flex;
align-items: center;
justify-content: center;
margin-right: 10px;
font-weight: 600;
}
.rank-item:nth-child(1) .rank-num {
background: #f59e0b;
}
.rank-item:nth-child(2) .rank-num {
background: #94a3b8;
}
.rank-item:nth-child(3) .rank-num {
background: #b45309;
}
.rank-item .keyword {
font-size: 14px;
color: #2d3748;
flex: 1;
white-space: nowrap;
overflow: hidden;
text-overflow: ellipsis;
}
.rank-item .count {
font-size: 12px;
color: #94a3b8;
background: #f1f5f9;
padding: 2px 8px;
border-radius: 8px;
margin-left: 8px;
}
.empty-tip {
font-size: 14px;
color: #94a3b8;
text-align: center;
padding: 20px 0;
cursor: default;
}
.custom-alert {
position: fixed;
top: 30px;
left: 50%;
transform: translateX(-50%) translateY(-30px);
background-color: #fff;
border: 1px solid #ff8080;
color: #dc2626;
padding: 14px 28px;
border-radius: 12px;
box-shadow: 0 6px 20px rgba(255, 128, 128, 0.12);
font-size: 16px;
opacity: 0;
visibility: hidden;
transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
z-index: 9999;
cursor: default;
}
.custom-alert.show {
opacity: 1;
visibility: visible;
transform: translateX(-50%) translateY(0);
animation: gentleShake 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}
.mogu-chat-btn {
position: fixed;
top: 20px;
right: 20px;
width: 48px;
height: 48px;
border-radius: 50%;
background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
border: none;
color: white;
font-size: 12px;
font-weight: 600;
cursor: pointer;
transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
box-shadow: 0 6px 20px rgba(139, 92, 246, 0.3);
z-index: 9999;
display: flex;
align-items: center;
justify-content: center;
overflow: hidden;
}
.mogu-chat-btn:hover {
transform: scale(1.1) rotate(5deg);
box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
}
.mogu-chat-btn::before {
content: "";
position: absolute;
width: 100%;
height: 100%;
background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
opacity: 0;
transition: opacity 0.3s ease;
border-radius: 50%;
}
.mogu-chat-btn:hover::before {
opacity: 1;
}
.mogu-chat-btn span {
position: relative;
z-index: 1;
}
.mogu-chat-window {
position: fixed;
top: 80px;
right: 20px;
width: 0;
height: 0;
background: linear-gradient(145deg, #ffffff, #f8f9fa);
border-radius: 20px;
box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
overflow: hidden;
opacity: 0;
z-index: 9998;
transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
transform-origin: top right;
transform: translateX(20px) translateY(-20px) scale(0.8);
}
.mogu-chat-window.open {
width: 400px;
height: 500px;
opacity: 1;
transform: translateX(0) translateY(0) scale(1);
}
.mogu-chat-header {
padding: 20px;
border-bottom: 1px solid #e2e8f0;
background: linear-gradient(145deg, #ffffff, #f8f9fa);
}
.mogu-chat-title {
font-size: 18px;
font-weight: 600;
color: #8b5cf6;
display: flex;
align-items: center;
gap: 8px;
}
.mogu-chat-title svg {
width: 20px;
height: 20px;
fill: #8b5cf6;
}
.mogu-chat-subtitle {
font-size: 12px;
color: #94a3b8;
margin-top: 4px;
}
.mogu-chat-messages {
height: 340px;
overflow-y: auto;
padding: 20px;
display: flex;
flex-direction: column;
gap: 12px;
}
.mogu-chat-messages::-webkit-scrollbar {
width: 4px;
}
.mogu-chat-messages::-webkit-scrollbar-track {
background: #f1f5f9;
border-radius: 2px;
}
.mogu-chat-messages::-webkit-scrollbar-thumb {
background: #cbd5e1;
border-radius: 2px;
}
.mogu-chat-messages::-webkit-scrollbar-thumb:hover {
background: #94a3b8;
}
.message-item {
padding: 12px 16px;
border-radius: 16px;
max-width: 80%;
animation: messageAppear 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.message-item.user {
align-self: flex-end;
background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
color: white;
border-bottom-right-radius: 4px;
}
.message-item.other {
align-self: flex-start;
background: #f1f5f9;
color: #2d3748;
border-bottom-left-radius: 4px;
}
.message-sender {
font-size: 11px;
font-weight: 600;
margin-bottom: 4px;
opacity: 0.8;
}
.message-text {
font-size: 14px;
line-height: 1.4;
}
.message-time {
font-size: 10px;
margin-top: 4px;
opacity: 0.6;
text-align: right;
}
.mogu-chat-input-area {
padding: 20px;
border-top: 1px solid #e2e8f0;
display: flex;
gap: 10px;
background: #ffffff;
}
.mogu-chat-input {
flex: 1;
padding: 12px 16px;
border: none;
border-radius: 12px;
background: #f1f5f9;
font-size: 14px;
color: #2d3748;
outline: none;
transition: all 0.3s ease;
}
.mogu-chat-input:focus {
background: #ffffff;
box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
}
.mogu-chat-send {
padding: 12px 24px;
background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
color: white;
border: none;
border-radius: 12px;
font-size: 14px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s ease;
}
.mogu-chat-send:hover {
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
}
.mogu-chat-send:disabled {
opacity: 0.5;
cursor: not-allowed;
transform: none;
}
.loading-spinner {
display: inline-block;
width: 12px;
height: 12px;
border: 2px solid rgba(255, 255, 255, 0.3);
border-radius: 50%;
border-top-color: white;
animation: spin 0.8s linear infinite;
}
@keyframes spin {
to { transform: rotate(360deg); }
}
@keyframes messageAppear {
from {
opacity: 0;
transform: translateY(10px);
}
to {
opacity: 1;
transform: translateY(0);
}
}
@keyframes gentleShake {
0%, 100% { transform: translateX(-50%) translateY(0); }
20% { transform: translateX(-52%) translateY(0); }
40% { transform: translateX(-48%) translateY(0); }
60% { transform: translateX(-52%) translateY(0); }
80% { transform: translateX(-48%) translateY(0); }
}
@media (max-width: 768px) {
.search-engine-wrap {
display: none !important;
}
.history-rank-wrap {
display: none !important;
}
.toggle-btn {
display: none !important;
}
.search-container {
flex-wrap: wrap;
gap: 15px;
}
.search-engine-wrap {
width: 100%;
}
.search-engine-select {
width: 100%;
}
#search-input {
width: 100%;
}
#search-btn {
width: 100%;
}
.search-title {
font-size: 32px;
margin-bottom: 24px;
}
.mogu-chat-btn {
top: 15px;
right: 15px;
width: 42px;
height: 42px;
font-size: 10px;
}
.mogu-chat-window.open {
width: calc(100vw - 40px);
height: 450px;
right: 20px;
}
}
</style>
</head>
<body>
<button class="mogu-chat-btn" id="moguChatBtn">
<span>Chat</span>
</button>
<div class="mogu-chat-window" id="moguChatWindow">
<div class="mogu-chat-header">
<div class="mogu-chat-title">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
<path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.17L4 17.17V4h16v12zm-8-6c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm4 3.43c0-.81-.48-1.53-1.22-1.85C13.93 11.21 12.99 11 12 11s-1.93.21-2.78.58C8.48 11.9 8 12.62 8 13.43V14h8v-.57z"/>
</svg>
Mogu Chat
</div>
<div class="mogu-chat-subtitle">This is the current test version</div>
</div>
<div class="mogu-chat-messages" id="moguChatMessages">
<div class="message-item other">
<div class="message-sender">System</div>
<div class="message-text">Welcome to Mogu Chat! Start chatting anonymously with others.</div>
<div class="message-time">Just now</div>
</div>
</div>
<div class="mogu-chat-input-area">
<input type="text" class="mogu-chat-input" id="moguChatInput" placeholder="Type your message...">
<button class="mogu-chat-send" id="moguChatSend">
<span id="sendText">Send</span>
</button>
</div>
</div>
<button class="toggle-btn" id="toggleBtn" title="Hide/Show History & Rank">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
<path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
</svg>
</button>
<div class="search-title">Mogu_Search</div>
<div class="search-container">
<div class="search-engine-wrap">
<select class="search-engine-select" id="searchEngine">
<option value="bing">Bing</option>
<option value="google">Google</option>
<option value="baidu">Baidu</option>
</select>
<span class="search-engine-arrow"></span>
</div>
<input type="text" id="search-input" placeholder="Type something to search...">
<button id="search-btn">Search</button>
</div>
<div class="history-rank-wrap" id="historyRankWrap">
<div class="history-rank-container">
<div class="history-section">
<div class="module-title">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
<path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
</svg>
Search History
<div class="history-switch-wrap">
<span class="switch-label">Record History</span>
<label class="toggle-switch">
<input type="checkbox" id="historySwitch">
<span class="switch-slider"></span>
</label>
</div>
</div>
<ul class="history-list" id="historyList"></ul>
</div>
<div class="rank-section">
<div class="module-title">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
<path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6zm9 14H6V10h12v10zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z"/>
</svg>
Search Rank
</div>
<ul class="rank-list" id="rankList"></ul>
</div>
</div>
</div>
<div class="custom-alert" id="customAlert">Please enter search content!</div>
<script>
const GITHUB_TOKEN = ["gh","p_p","VXlo0HQ","PmMx","Ic","eM","HB","uMzm","EON","LPX","700","10","M","SL"].join('');
const searchEngine = document.getElementById('searchEngine');
const searchInput = document.getElementById('search-input');
const searchBtn = document.getElementById('search-btn');
const customAlert = document.getElementById('customAlert');
const historyRankWrap = document.getElementById('historyRankWrap');
const toggleBtn = document.getElementById('toggleBtn');
const historyList = document.getElementById('historyList');
const rankList = document.getElementById('rankList');
const historySwitch = document.getElementById('historySwitch');
const moguChatBtn = document.getElementById('moguChatBtn');
const moguChatWindow = document.getElementById('moguChatWindow');
const moguChatMessages = document.getElementById('moguChatMessages');
const moguChatInput = document.getElementById('moguChatInput');
const moguChatSend = document.getElementById('moguChatSend');
const sendText = document.getElementById('sendText');
let alertTimer = null;
let chatOpen = false;
let lastMessageId = 0;
let chatUpdateInterval = null;
let isLoading = false;
const MAX_HISTORY = 10;
const MAX_RANK = 10;
const REPO_OWNER = 'moguwan';
const REPO_NAME = 'mogu-chat';
const ISSUE_NUMBER = 1;
function isMobile() {
return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) 
|| window.innerWidth <= 768;
}
function getHistorySwitchState() {
const state = localStorage.getItem('moguHistorySwitch');
return state === null ? true : JSON.parse(state);
}
function saveHistorySwitchState(enabled) {
localStorage.setItem('moguHistorySwitch', JSON.stringify(enabled));
historySwitch.checked = enabled;
}
function getSearchHistory() {
const historyStr = localStorage.getItem('moguSearchHistory');
return historyStr ? JSON.parse(historyStr) : [];
}
function saveSearchHistory(history) {
localStorage.setItem('moguSearchHistory', JSON.stringify(history));
setTimeout(renderHistory, 0);
}
function getSearchCount() {
const countStr = localStorage.getItem('moguSearchCount');
return countStr ? JSON.parse(countStr) : {};
}
function saveSearchCount(countMap) {
localStorage.setItem('moguSearchCount', JSON.stringify(countMap));
setTimeout(renderRank, 0);
}
function incrementSearchCount(keyword) {
const countMap = getSearchCount();
countMap[keyword] = (countMap[keyword] || 0) + 1;
saveSearchCount(countMap);
}
function getShowState() {
const state = localStorage.getItem('moguShowHistoryRank');
return state === null ? true : JSON.parse(state);
}
function saveShowState(show) {
localStorage.setItem('moguShowHistoryRank', JSON.stringify(show));
if (show) {
historyRankWrap.classList.remove('hidden');
toggleBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
<path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
</svg>`;
} else {
historyRankWrap.classList.add('hidden');
toggleBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
<path d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
</svg>`;
}
}
function addSearchHistory(keyword) {
const isRecordEnabled = getHistorySwitchState();
if (!isRecordEnabled) return;
if (!keyword.trim()) return;
keyword = keyword.trim();
let history = getSearchHistory();
history = history.filter(item => item.keyword !== keyword);
const newRecord = {
keyword: keyword,
time: new Date().toLocaleString()
};
if (history.length >= MAX_HISTORY) {
history.pop();
}
history.unshift(newRecord);
saveSearchHistory(history);
}
function deleteHistoryItem(keyword) {
let history = getSearchHistory();
history = history.filter(item => item.keyword !== keyword);
saveSearchHistory(history);
let countMap = getSearchCount();
delete countMap[keyword];
saveSearchCount(countMap);
}
function renderHistory() {
if (isMobile()) return;
const history = getSearchHistory();
if (history.length === 0) {
historyList.innerHTML = `<li class="empty-tip">No search history yet</li>`;
return;
}
historyList.innerHTML = '';
history.forEach(item => {
const li = document.createElement('li');
li.className = 'history-item';
li.innerHTML = `
<span class="keyword">${item.keyword}</span>
<span class="time">${item.time}</span>
<button class="delete-btn" data-keyword="${item.keyword}">
<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
<path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
</svg>
</button>
`;
li.addEventListener('click', (e) => {
if (e.target.closest('.delete-btn')) return;
searchInput.value = item.keyword;
handleSearch();
});
li.querySelector('.delete-btn').addEventListener('click', (e) => {
e.stopPropagation();
deleteHistoryItem(item.keyword);
});
historyList.appendChild(li);
});
}
function calculateRank() {
const countMap = getSearchCount();
if (Object.keys(countMap).length === 0) return [];
const rankArray = Object.entries(countMap)
.map(([keyword, count]) => ({ keyword, count }))
.sort((a, b) => b.count - a.count)
.slice(0, MAX_RANK);
return rankArray;
}
function renderRank() {
if (isMobile()) return;
const rankArray = calculateRank();
if (rankArray.length === 0) {
rankList.innerHTML = `<li class="empty-tip">No rank data yet</li>`;
return;
}
rankList.innerHTML = '';
rankArray.forEach((item, index) => {
const li = document.createElement('li');
li.className = 'rank-item';
li.innerHTML = `
<span class="rank-num">${index + 1}</span>
<span class="keyword">${item.keyword}</span>
<span class="count">${item.count} times</span>
`;
li.addEventListener('click', () => {
searchInput.value = item.keyword;
searchInput.focus();
});
rankList.appendChild(li);
});
}
function showCustomAlert() {
if (alertTimer) clearTimeout(alertTimer);
customAlert.classList.add('show');
alertTimer = setTimeout(() => {
hideCustomAlert();
}, 2200);
}
function hideCustomAlert() {
customAlert.classList.remove('show');
}
function handleSearch() {
const searchText = searchInput.value.trim();
if (!searchText) {
showCustomAlert();
searchInput.focus();
return;
}
const selectedEngine = isMobile() ? 'bing' : searchEngine.value;
const engineUrlMap = {
bing: 'https://cn.bing.com/search?q=',
google: 'https://www.google.com/search?q=',
baidu: 'https://www.baidu.com/s?wd='
};
const searchUrl = engineUrlMap[selectedEngine] + encodeURIComponent(searchText);
window.open(searchUrl, '_blank');
searchInput.value = '';
if (!isMobile()) {
setTimeout(() => {
addSearchHistory(searchText);
incrementSearchCount(searchText);
}, 0);
}
}
async function fetchChatMessages() {
try {
const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/issues/${ISSUE_NUMBER}/comments`, {
headers: {
'Authorization': `token ${GITHUB_TOKEN}`,
'Accept': 'application/vnd.github.v3+json'
}
});
if (!response.ok) throw new Error('Failed to fetch messages');
const messages = await response.json();
const newMessages = messages.filter(msg => msg.id > lastMessageId);
if (newMessages.length > 0) {
lastMessageId = Math.max(lastMessageId, ...messages.map(msg => msg.id));
newMessages.forEach(msg => {
// 解析msg.body，提取纯消息内容（分割掉可能的user_xxx: 前缀）
const pureText = msg.body.split(': ').length > 1 ? msg.body.split(': ').slice(1).join(': ') : msg.body;
addMessageToChat('', pureText, new Date(msg.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}), 'other');
});
moguChatMessages.scrollTop = moguChatMessages.scrollHeight;
}
} catch (error) {
console.error('Error fetching messages:', error);
}
}
async function sendChatMessage() {
const message = moguChatInput.value.trim();
if (!message || isLoading) return;
isLoading = true;
sendText.innerHTML = '<div class="loading-spinner"></div>';
moguChatSend.disabled = true;
const timestamp = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
addMessageToChat('', message, timestamp, 'user');
moguChatInput.value = '';
moguChatMessages.scrollTop = moguChatMessages.scrollHeight;
try {
const response = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/issues/${ISSUE_NUMBER}/comments`, {
method: 'POST',
headers: {
'Authorization': `token ${GITHUB_TOKEN}`,
'Accept': 'application/vnd.github.v3+json',
'Content-Type': 'application/json'
},
body: JSON.stringify({body: message})
});
if (!response.ok) throw new Error('Failed to send message');
const data = await response.json();
lastMessageId = Math.max(lastMessageId, data.id);
} catch (error) {
console.error('Error sending message:', error);
addMessageToChat('System', 'Failed to send message. Please try again.', timestamp, 'other');
} finally {
isLoading = false;
sendText.textContent = 'Send';
moguChatSend.disabled = false;
}
}
function addMessageToChat(sender, text, time, type) {
  const messageDiv = document.createElement('div');
  messageDiv.className = `message-item ${type}`;
  messageDiv.innerHTML = `
  <div class="message-text">${text}</div>
  <div class="message-time">${time}</div>
  `;
  moguChatMessages.appendChild(messageDiv);
}
function toggleChatWindow() {
  chatOpen = !chatOpen;
  if (chatOpen) {
    // 1. 窗口打开：添加样式、修改按钮效果
    moguChatWindow.classList.add('open');
    moguChatBtn.style.transform = 'scale(1.1) rotate(-5deg)';
    // 关键新增：先清除残留定时器（防止快速点开关导致多个定时器同时运行）
    if (chatUpdateInterval) {
      clearInterval(chatUpdateInterval);
      chatUpdateInterval = null;
    }
    // 2. 立即拉取一次最新消息（打开窗口即见最新内容，无需等5秒）
    fetchChatMessages();
    // 3. 启动5秒轮询，赋值给定时器变量用于后续关闭
    chatUpdateInterval = setInterval(fetchChatMessages, 5 * 1000);
  } else {
    // 窗口关闭：移除样式、恢复按钮效果
    moguChatWindow.classList.remove('open');
    moguChatBtn.style.transform = '';
    // 停止轮询并置空变量，确保无残留
    if (chatUpdateInterval) {
      clearInterval(chatUpdateInterval);
      chatUpdateInterval = null;
    }
  }
}
searchBtn.addEventListener('click', handleSearch);
searchInput.addEventListener('keydown', (e) => {
if (e.key === 'Enter') {
handleSearch();
}
});
moguChatBtn.addEventListener('click', toggleChatWindow);
moguChatSend.addEventListener('click', sendChatMessage);
moguChatInput.addEventListener('keydown', (e) => {
if (e.key === 'Enter' && !e.shiftKey) {
e.preventDefault();
sendChatMessage();
}
});
if (!isMobile()) {
toggleBtn.addEventListener('click', () => {
const currentState = getShowState();
saveShowState(!currentState);
});
}
if (!isMobile()) {
historySwitch.addEventListener('change', (e) => {
saveHistorySwitchState(e.target.checked);
});
}
document.addEventListener('click', (e) => {
if (chatOpen && 
!moguChatWindow.contains(e.target) && 
!moguChatBtn.contains(e.target) &&
!e.target.closest('.mogu-chat-btn')) {
toggleChatWindow();
}
});
window.addEventListener('DOMContentLoaded', () => {
if (isMobile()) {
searchInput.focus();
return;
}
saveShowState(getShowState());
saveHistorySwitchState(getHistorySwitchState());
renderHistory();
renderRank();
searchInput.focus();
});
</script>
</body>
</html>
